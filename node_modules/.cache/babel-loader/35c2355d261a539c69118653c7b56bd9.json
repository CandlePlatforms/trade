{"ast":null,"code":"import NodeDetailManager from '@toruslabs/fetch-node-details';\nimport { get, setAPIKey } from '@toruslabs/http-helpers';\nimport { SafeEventEmitter, ObjectMultiplex, createStreamMiddleware, JRPCEngine, createIdRemapMiddleware, BasePostMessageStream, setupMultiplex } from '@toruslabs/openlogin-jrpc';\nimport TorusJs from '@toruslabs/torus.js';\nimport deepmerge from 'lodash.merge';\nimport { ObservableStore, storeAsStream } from '@metamask/obs-store';\nimport { ethErrors, EthereumRpcError } from 'eth-rpc-errors';\nimport dequal from 'fast-deep-equal';\nimport { isDuplexStream } from 'is-stream';\nimport pump from 'pump';\nimport loglevel from 'loglevel';\nimport createHash from 'create-hash';\nimport { EventEmitter } from 'events';\n/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation.\r\n\r\nPermission to use, copy, modify, and/or distribute this software for any\r\npurpose with or without fee is hereby granted.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\r\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\r\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\r\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\r\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\r\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\r\nPERFORMANCE OF THIS SOFTWARE.\r\n***************************************************************************** */\n\nfunction __rest(s, e) {\n  var t = {};\n\n  for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0) t[p] = s[p];\n\n  if (s != null && typeof Object.getOwnPropertySymbols === \"function\") for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n    if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i])) t[p[i]] = s[p[i]];\n  }\n  return t;\n}\n\nfunction __awaiter(thisArg, _arguments, P, generator) {\n  function adopt(value) {\n    return value instanceof P ? value : new P(function (resolve) {\n      resolve(value);\n    });\n  }\n\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function step(result) {\n      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);\n    }\n\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n}\n\nconst LOGIN_PROVIDER = {\n  GOOGLE: \"google\",\n  FACEBOOK: \"facebook\",\n  TWITCH: \"twitch\",\n  REDDIT: \"reddit\",\n  DISCORD: \"discord\"\n};\nconst WALLET_OPENLOGIN_VERIFIER_MAP = {\n  [LOGIN_PROVIDER.GOOGLE]: \"tkey-google\",\n  [LOGIN_PROVIDER.FACEBOOK]: \"tkey-facebook\",\n  [LOGIN_PROVIDER.TWITCH]: \"tkey-twitch\",\n  [LOGIN_PROVIDER.REDDIT]: \"tkey-reddit\",\n  [LOGIN_PROVIDER.DISCORD]: \"tkey-discord\"\n};\nconst PAYMENT_PROVIDER = {\n  MOONPAY: \"moonpay\",\n  WYRE: \"wyre\",\n  RAMPNETWORK: \"rampnetwork\",\n  XANPOOL: \"xanpool\",\n  MERCURYO: \"mercuryo\",\n  TRANSAK: \"transak\"\n};\nconst TORUS_BUILD_ENV = {\n  PRODUCTION: \"production\",\n  DEVELOPMENT: \"development\",\n  BINANCE: \"binance\",\n  TESTING: \"testing\",\n  LRC: \"lrc\",\n  BETA: \"beta\"\n};\nconst BUTTON_POSITION = {\n  BOTTOM_LEFT: \"bottom-left\",\n  TOP_LEFT: \"top-left\",\n  BOTTOM_RIGHT: \"bottom-right\",\n  TOP_RIGHT: \"top-right\"\n};\nconst paymentProviders$1 = {\n  [PAYMENT_PROVIDER.RAMPNETWORK]: {\n    line1: \"Debit Card/ Apple Pay/ Bank transfer\",\n    line2: \"0.49% - 2.9%\",\n    line3: \"5,000€/purchase, 20,000€/mo\",\n    supportPage: \"https://instant.ramp.network/\",\n    minOrderValue: 50,\n    maxOrderValue: 20000,\n    validCurrencies: [\"GBP\", \"EUR\", \"USD\"],\n    validCryptoCurrencies: [\"ETH\", \"DAI\", \"USDC\", \"BSC_BNB\"],\n    includeFees: true,\n    enforceMax: false\n  },\n  [PAYMENT_PROVIDER.MOONPAY]: {\n    line1: \"Credit / Debit Card / Apple Pay\",\n    line2: \"4.5% or 5 USD\",\n    line3: \"2,000€/day, 10,000€/mo\",\n    supportPage: \"https://help.moonpay.io/en/\",\n    minOrderValue: 24.99,\n    maxOrderValue: 50000,\n    validCurrencies: [\"USD\", \"EUR\", \"GBP\", \"AUD\", \"CAD\", \"SGD\", \"RUB\"],\n    validCryptoCurrencies: [\"ETH\", \"DAI\", \"TUSD\", \"USDC\", \"USDT\", \"BNB_BSC\", \"BUSD_BSC\"],\n    includeFees: true,\n    enforceMax: false\n  },\n  [PAYMENT_PROVIDER.WYRE]: {\n    line1: \"Apple Pay/ Debit/ Credit Card\",\n    line2: \"4.9% + 30¢ or 5 USD\",\n    line3: \"$250/day\",\n    supportPage: \"https://support.sendwyre.com/en/\",\n    minOrderValue: 5,\n    maxOrderValue: 500,\n    validCurrencies: [\"USD\", \"AUD\", \"CAD\", \"GBP\", \"EUR\"],\n    validCryptoCurrencies: [\"ETH\", \"DAI\", \"USDC\", \"USDT\"],\n    includeFees: false,\n    enforceMax: false\n  },\n  [PAYMENT_PROVIDER.XANPOOL]: {\n    line1: \"PayNow/ InstaPay/ FPS/ GoJekPay/ UPI/ PromptPay/ VietelPay/ DuitNow\",\n    line2: \"2.5% buying, 3% selling\",\n    line3: \"$2,500 / day\",\n    supportPage: \"mailto:support@xanpool.com\",\n    minOrderValue: 100,\n    maxOrderValue: 2500,\n    validCurrencies: [\"SGD\", \"HKD\", \"MYR\", \"PHP\", \"INR\", \"VND\", \"THB\", \"IDR\"],\n    validCryptoCurrencies: [\"ETH\", \"USDT\"],\n    includeFees: true,\n    sell: true,\n    enforceMax: false\n  },\n  [PAYMENT_PROVIDER.MERCURYO]: {\n    line1: \"Credit/ Debit Card/ Apple Pay\",\n    line2: \"3.95% or 4 USD\",\n    line3: \"10,000€/day, 25,000€/mo\",\n    supportPage: \"mailto:support@mercuryo.io\",\n    minOrderValue: 30,\n    maxOrderValue: 5000,\n    validCurrencies: [\"USD\", \"EUR\", \"RUB\", \"TRY\", \"GBP\", \"UAH\"],\n    validCryptoCurrencies: [\"ETH\", \"DAI\", \"BAT\", \"USDT\", \"OKB\"],\n    includeFees: true,\n    enforceMax: false\n  },\n  [PAYMENT_PROVIDER.TRANSAK]: {\n    line1: \"Credit/ Debit Card/ <br/>Bank Transfer (sepa/gbp)\",\n    line2: \"0.99% - 5.5% or 5 USD\",\n    line3: \"500€/day\",\n    supportPage: \"https://support.transak.com/hc/en-US\",\n    minOrderValue: 20,\n    maxOrderValue: 500,\n    validCurrencies: [\"USD\", \"EUR\", \"GBP\", \"AUD\", \"CAD\", \"SGD\"],\n    validCryptoCurrencies: [\"ETH\", \"DAI\", \"USDC\", \"USDT\"],\n    includeFees: true,\n    enforceMax: false\n  }\n};\nconst translations = {\n  en: {\n    embed: {\n      continue: \"Continue\",\n      actionRequired: \"Authorization required\",\n      pendingAction: \"Click continue to proceed with your request in a popup\",\n      cookiesRequired: \"Cookies Required\",\n      enableCookies: \"Please enable cookies in your browser preferences to access Torus\",\n      clickHere: \"More Info\"\n    }\n  },\n  de: {\n    embed: {\n      continue: \"Fortsetzen\",\n      actionRequired: \"Autorisierung erforderlich\",\n      pendingAction: \"Klicken Sie in einem Popup auf Weiter, um mit Ihrer Anfrage fortzufahren\",\n      cookiesRequired: \"Cookies benötigt\",\n      enableCookies: \"Bitte aktivieren Sie Cookies in Ihren Browsereinstellungen, um auf Torus zuzugreifen\",\n      clickHere: \"Mehr Info\"\n    }\n  },\n  ja: {\n    embed: {\n      continue: \"継続する\",\n      actionRequired: \"認証が必要です\",\n      pendingAction: \"続行をクリックして、ポップアップでリクエストを続行します\",\n      cookiesRequired: \"必要なクッキー\",\n      enableCookies: \"Torusにアクセスするには、ブラウザの設定でCookieを有効にしてください。\",\n      clickHere: \"詳しくは\"\n    }\n  },\n  ko: {\n    embed: {\n      continue: \"계속하다\",\n      actionRequired: \"승인 필요\",\n      pendingAction: \"팝업에서 요청을 진행하려면 계속을 클릭하십시오.\",\n      cookiesRequired: \"쿠키 필요\",\n      enableCookies: \"브라우저 환경 설정에서 쿠키를 활성화하여 Torus에 액세스하십시오.\",\n      clickHere: \"더 많은 정보\"\n    }\n  },\n  zh: {\n    embed: {\n      continue: \"继续\",\n      actionRequired: \"需要授权\",\n      pendingAction: \"单击继续以在弹出窗口中继续您的请求\",\n      cookiesRequired: \"必填Cookie\",\n      enableCookies: \"请在您的浏览器首选项中启用cookie以访问Torus。\",\n      clickHere: \"更多信息\"\n    }\n  }\n};\nvar configuration = {\n  supportedVerifierList: [LOGIN_PROVIDER.GOOGLE, LOGIN_PROVIDER.REDDIT, LOGIN_PROVIDER.DISCORD],\n  paymentProviders: paymentProviders$1,\n  api: \"https://api.tor.us\",\n  translations,\n  prodTorusUrl: \"\",\n  localStorageKey: `torus-${window.location.hostname}`\n};\n\nconst runOnLoad = fn => new Promise((resolve, reject) => {\n  if (window.document.body != null) {\n    Promise.resolve(fn()).then(resolve).catch(reject);\n  } else {\n    window.document.addEventListener(\"DOMContentLoaded\", () => {\n      Promise.resolve(fn()).then(resolve).catch(reject);\n    });\n  }\n});\n\nconst htmlToElement = html => {\n  const template = window.document.createElement(\"template\");\n  const trimmedHtml = html.trim(); // Never return a text node of whitespace as the result\n\n  template.innerHTML = trimmedHtml;\n  return template.content.firstChild;\n};\n\nconst handleEvent = function (handle, eventName, handler) {\n  for (var _len = arguments.length, handlerArgs = new Array(_len > 3 ? _len - 3 : 0), _key = 3; _key < _len; _key++) {\n    handlerArgs[_key - 3] = arguments[_key];\n  }\n\n  const handlerWrapper = () => {\n    handler(...handlerArgs);\n    handle.removeEventListener(eventName, handlerWrapper);\n  };\n\n  handle.addEventListener(eventName, handlerWrapper);\n};\n\nconst handleStream = (handle, eventName, handler) => {\n  const handlerWrapper = chunk => {\n    handler(chunk);\n    handle.removeListener(eventName, handlerWrapper);\n  };\n\n  handle.on(eventName, handlerWrapper);\n};\n\nfunction documentReady() {\n  return __awaiter(this, void 0, void 0, function* () {\n    return new Promise(resolve => {\n      if (document.readyState !== \"loading\") {\n        resolve();\n      } else {\n        handleEvent(document, \"DOMContentLoaded\", resolve);\n      }\n    });\n  });\n}\n\nvar log = loglevel.getLogger(\"torus-embed\");\nvar messages = {\n  errors: {\n    disconnected: () => \"Torus: Lost connection to Torus.\",\n    permanentlyDisconnected: () => \"Torus: Disconnected from iframe. Page reload required.\",\n    sendSiteMetadata: () => \"Torus: Failed to send site metadata. This is an internal error, please report this bug.\",\n    unsupportedSync: method => `Torus: The Torus Ethereum provider does not support synchronous methods like ${method} without a callback parameter.`,\n    invalidDuplexStream: () => \"Must provide a Node.js-style duplex stream.\",\n    invalidOptions: (maxEventListeners, shouldSendMetadata) => `Invalid options. Received: { maxEventListeners: ${maxEventListeners}, shouldSendMetadata: ${shouldSendMetadata} }`,\n    invalidRequestArgs: () => `Expected a single, non-array, object argument.`,\n    invalidRequestMethod: () => `'args.method' must be a non-empty string.`,\n    invalidRequestParams: () => `'args.params' must be an object or array if provided.`,\n    invalidLoggerObject: () => `'args.logger' must be an object if provided.`,\n    invalidLoggerMethod: method => `'args.logger' must include required method '${method}'.`\n  },\n  info: {\n    connected: chainId => `Torus: Connected to chain with ID \"${chainId}\".`\n  },\n  warnings: {\n    // deprecated methods\n    enableDeprecation: 'Torus: \"\"ethereum.enable()\" is deprecated and may be removed in the future. ' + 'Please use \"ethereum.send(\"eth_requestAccounts\")\" instead. For more information, see: https://eips.ethereum.org/EIPS/eip-1102',\n    sendDeprecation: 'Torus: \"ethereum.send(...)\" is deprecated and may be removed in the future.' + ' Please use \"ethereum.sendAsync(...)\" or \"ethereum.request(...)\" instead.\\nFor more information, see: https://eips.ethereum.org/EIPS/eip-1193',\n    events: {\n      close: 'Torus: The event \"close\" is deprecated and may be removed in the future. Please use \"disconnect\" instead.' + \"\\nFor more information, see: https://eips.ethereum.org/EIPS/eip-1193\",\n      data: 'Torus: The event \"data\" is deprecated and will be removed in the future.' + 'Use \"message\" instead.\\nFor more information, see: https://eips.ethereum.org/EIPS/eip-1193#message',\n      networkChanged: 'Torus: The event \"networkChanged\" is deprecated and may be removed in the future.' + ' Please use \"chainChanged\" instead.\\nFor more information, see: https://eips.ethereum.org/EIPS/eip-1193',\n      notification: 'Torus: The event \"notification\" is deprecated and may be removed in the future. ' + 'Please use \"message\" instead.\\nFor more information, see: https://eips.ethereum.org/EIPS/eip-1193'\n    },\n    publicConfigStore: 'Torus: The property \"publicConfigStore\" is deprecated and WILL be removed in the future.'\n  }\n};\nconst {\n  paymentProviders\n} = configuration;\n\nconst validatePaymentProvider = (provider, params) => {\n  const errors = {};\n\n  if (!provider) {\n    return {\n      errors,\n      isValid: true\n    };\n  }\n\n  if (provider && !paymentProviders[provider]) {\n    errors.provider = \"Invalid Provider\";\n    return {\n      errors,\n      isValid: Object.keys(errors).length === 0\n    };\n  }\n\n  const selectedProvider = paymentProviders[provider];\n  const selectedParams = params || {}; // set default values\n  // if (!selectedParams.selectedCurrency) [selectedParams.selectedCurrency] = selectedProvider.validCurrencies\n  // if (!selectedParams.fiatValue) selectedParams.fiatValue = selectedProvider.minOrderValue\n  // if (!selectedParams.selectedCryptoCurrency) [selectedParams.selectedCryptoCurrency] = selectedProvider.validCryptoCurrencies\n  // validations\n\n  if (selectedParams.fiatValue) {\n    const requestedOrderAmount = +parseFloat(selectedParams.fiatValue.toString()) || 0;\n    if (requestedOrderAmount < selectedProvider.minOrderValue) errors.fiatValue = \"Requested amount is lower than supported\";\n    if (requestedOrderAmount > selectedProvider.maxOrderValue && selectedProvider.enforceMax) errors.fiatValue = \"Requested amount is higher than supported\";\n  }\n\n  if (selectedParams.selectedCurrency && !selectedProvider.validCurrencies.includes(selectedParams.selectedCurrency)) {\n    errors.selectedCurrency = \"Unsupported currency\";\n  }\n\n  if (selectedParams.selectedCryptoCurrency && !selectedProvider.validCryptoCurrencies.includes(selectedParams.selectedCryptoCurrency)) {\n    errors.selectedCryptoCurrency = \"Unsupported cryptoCurrency\";\n  }\n\n  return {\n    errors,\n    isValid: Object.keys(errors).length === 0\n  };\n}; // utility functions\n\n/**\n * json-rpc-engine middleware that logs RPC errors and and validates req.method.\n *\n * @param log - The logging API to use.\n * @returns  json-rpc-engine middleware function\n */\n\n\nfunction createErrorMiddleware() {\n  return (req, res, next) => {\n    // json-rpc-engine will terminate the request when it notices this error\n    if (typeof req.method !== \"string\" || !req.method) {\n      res.error = ethErrors.rpc.invalidRequest({\n        message: `The request 'method' must be a non-empty string.`,\n        data: req\n      });\n    }\n\n    next(done => {\n      const {\n        error\n      } = res;\n\n      if (!error) {\n        return done();\n      }\n\n      log.error(`MetaMask - RPC Error: ${error.message}`, error);\n      return done();\n    });\n  };\n}\n/**\n * Logs a stream disconnection error. Emits an 'error' if given an\n * EventEmitter that has listeners for the 'error' event.\n *\n * @param log - The logging API to use.\n * @param remoteLabel - The label of the disconnected stream.\n * @param error - The associated error to log.\n * @param emitter - The logging API to use.\n */\n\n\nfunction logStreamDisconnectWarning(remoteLabel, error, emitter) {\n  let warningMsg = `MetaMask: Lost connection to \"${remoteLabel}\".`;\n\n  if (error === null || error === void 0 ? void 0 : error.stack) {\n    warningMsg += `\\n${error.stack}`;\n  }\n\n  log.warn(warningMsg);\n\n  if (emitter && emitter.listenerCount(\"error\") > 0) {\n    emitter.emit(\"error\", warningMsg);\n  }\n}\n\nconst getPreopenInstanceId = () => Math.random().toString(36).slice(2);\n\nconst getTorusUrl = (buildEnv, integrity) => __awaiter(void 0, void 0, void 0, function* () {\n  let torusUrl;\n  let logLevel; // Do not change this line\n\n  const version = \"1.18.6\";\n  let versionUsed = integrity.version || version;\n\n  try {\n    if ((buildEnv === \"binance\" || buildEnv === \"production\") && !integrity.version) {\n      let response;\n      if (!configuration.prodTorusUrl) response = yield get(`${configuration.api}/latestversion?name=@toruslabs/torus-embed&version=${version}`, {}, {\n        useAPIKey: true\n      });else response = {\n        data: configuration.prodTorusUrl\n      };\n      versionUsed = response.data; // eslint-disable-next-line require-atomic-updates\n\n      configuration.prodTorusUrl = response.data;\n    }\n  } catch (error) {\n    log.error(error, \"unable to fetch latest version\");\n  }\n\n  log.info(\"version used: \", versionUsed);\n\n  switch (buildEnv) {\n    case \"binance\":\n      torusUrl = `https://binance.tor.us/v${versionUsed}`;\n      logLevel = \"info\";\n      break;\n\n    case \"testing\":\n      torusUrl = \"https://testing.tor.us\";\n      logLevel = \"debug\";\n      break;\n\n    case \"lrc\":\n      torusUrl = \"https://lrc.tor.us\";\n      logLevel = \"debug\";\n      break;\n\n    case \"beta\":\n      torusUrl = \"https://beta.tor.us\";\n      logLevel = \"debug\";\n      break;\n\n    case \"development\":\n      torusUrl = \"http://localhost:4050\";\n      logLevel = \"debug\";\n      break;\n\n    default:\n      torusUrl = `https://app.tor.us/v${versionUsed}`;\n      logLevel = \"error\";\n      break;\n  }\n\n  return {\n    torusUrl,\n    logLevel\n  };\n});\n\nconst getUserLanguage = () => {\n  let userLanguage = window.navigator.language || \"en-US\";\n  const userLanguages = userLanguage.split(\"-\");\n  userLanguage = Object.prototype.hasOwnProperty.call(configuration.translations, userLanguages[0]) ? userLanguages[0] : \"en\";\n  return userLanguage;\n};\n\nconst EMITTED_NOTIFICATIONS = [\"eth_subscription\" // per eth-json-rpc-filters/subscriptionManager\n];\n\nconst NOOP = () => {// empty function\n};\n\nconst FEATURES_PROVIDER_CHANGE_WINDOW = \"directories=0,titlebar=0,toolbar=0,status=0,location=0,menubar=0,height=660,width=375\";\nconst FEATURES_DEFAULT_WALLET_WINDOW = \"directories=0,titlebar=0,toolbar=0,status=0,location=0,menubar=0,height=740,width=1315\";\nconst FEATURES_CONFIRM_WINDOW = \"directories=0,titlebar=0,toolbar=0,status=0,location=0,menubar=0,height=700,width=450\";\n\nfunction storageAvailable(type) {\n  let storage;\n\n  try {\n    storage = window[type];\n    const x = \"__storage_test__\";\n    storage.setItem(x, x);\n    storage.removeItem(x);\n    return true;\n  } catch (e) {\n    return e && ( // everything except Firefox\n    e.code === 22 || // Firefox\n    e.code === 1014 || // test name field too, because code might not be present\n    // everything except Firefox\n    e.name === \"QuotaExceededError\" || // Firefox\n    e.name === \"NS_ERROR_DOM_QUOTA_REACHED\") && // acknowledge QuotaExceededError only if there's something already stored\n    storage && storage.length !== 0;\n  }\n}\n\nfunction getPopupFeatures() {\n  // Fixes dual-screen position                             Most browsers      Firefox\n  const dualScreenLeft = window.screenLeft !== undefined ? window.screenLeft : window.screenX;\n  const dualScreenTop = window.screenTop !== undefined ? window.screenTop : window.screenY;\n  const w = 1200;\n  const h = 700;\n  const width = window.innerWidth ? window.innerWidth : document.documentElement.clientWidth ? document.documentElement.clientWidth : window.screen.width;\n  const height = window.innerHeight ? window.innerHeight : document.documentElement.clientHeight ? document.documentElement.clientHeight : window.screen.height;\n  const systemZoom = 1; // No reliable estimate\n\n  const left = Math.abs((width - w) / 2 / systemZoom + dualScreenLeft);\n  const top = Math.abs((height - h) / 2 / systemZoom + dualScreenTop);\n  const features = `titlebar=0,toolbar=0,status=0,location=0,menubar=0,height=${h / systemZoom},width=${w / systemZoom},top=${top},left=${left}`;\n  return features;\n}\n\nSafeEventEmitter.defaultMaxListeners = 100; // resolve response.result, reject errors\n\nconst getRpcPromiseCallback = function (resolve, reject) {\n  let unwrapResult = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : true;\n  return (error, response) => {\n    if (error || response.error) {\n      return reject(error || response.error);\n    }\n\n    return !unwrapResult || Array.isArray(response) ? resolve(response) : resolve(response.result);\n  };\n};\n\nclass TorusInpageProvider extends SafeEventEmitter {\n  constructor(connectionStream) {\n    let {\n      maxEventListeners = 100,\n      shouldSendMetadata = true,\n      jsonRpcStreamName = \"provider\"\n    } = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n    super();\n    this._sentWarnings = {\n      // methods\n      enable: false,\n      experimentalMethods: false,\n      send: false,\n      publicConfigStore: false,\n      // events\n      events: {\n        close: false,\n        data: false,\n        networkChanged: false,\n        notification: false\n      }\n    };\n\n    if (!isDuplexStream(connectionStream)) {\n      throw new Error(messages.errors.invalidDuplexStream());\n    }\n\n    this.isTorus = true;\n    this.setMaxListeners(maxEventListeners); // private state\n\n    this._state = Object.assign({}, TorusInpageProvider._defaultState); // public state\n\n    this.selectedAddress = null;\n    this.networkVersion = null;\n    this.chainId = null;\n    this.shouldSendMetadata = shouldSendMetadata; // bind functions (to prevent e.g. web3@1.x from making unbound calls)\n\n    this._handleAccountsChanged = this._handleAccountsChanged.bind(this);\n    this._handleChainChanged = this._handleChainChanged.bind(this);\n    this._handleUnlockStateChanged = this._handleUnlockStateChanged.bind(this);\n    this._handleConnect = this._handleConnect.bind(this);\n    this._handleDisconnect = this._handleDisconnect.bind(this);\n    this._handleStreamDisconnect = this._handleStreamDisconnect.bind(this);\n    this._sendSync = this._sendSync.bind(this);\n    this._rpcRequest = this._rpcRequest.bind(this);\n    this._warnOfDeprecation = this._warnOfDeprecation.bind(this);\n    this._initializeState = this._initializeState.bind(this);\n    this.request = this.request.bind(this);\n    this.send = this.send.bind(this);\n    this.sendAsync = this.sendAsync.bind(this); // this.enable = this.enable.bind(this);\n    // setup connectionStream multiplexing\n\n    const mux = new ObjectMultiplex();\n    pump(connectionStream, mux, connectionStream, this._handleStreamDisconnect.bind(this, \"MetaMask\")); // subscribe to metamask public config (one-way)\n\n    this._publicConfigStore = new ObservableStore({\n      storageKey: \"Metamask-Config\"\n    }); // handle isUnlocked changes, and chainChanged and networkChanged events\n    // this._publicConfigStore.subscribe((stringifiedState) => {\n    //   // This is because we are using store as string\n    //   const state = JSON.parse(stringifiedState as unknown as string);\n    //   if (\"isUnlocked\" in state && state.isUnlocked !== this._state.isUnlocked) {\n    //     this._state.isUnlocked = state.isUnlocked;\n    //     if (!this._state.isUnlocked) {\n    //       // accounts are never exposed when the extension is locked\n    //       this._handleAccountsChanged([]);\n    //     } else {\n    //       // this will get the exposed accounts, if any\n    //       try {\n    //         this._rpcRequest(\n    //           { method: \"eth_accounts\", params: [] },\n    //           NOOP,\n    //           true // indicating that eth_accounts _should_ update accounts\n    //         );\n    //       } catch (_) {\n    //         // Swallow error\n    //       }\n    //     }\n    //   }\n    //   if (\"selectedAddress\" in state && this.selectedAddress !== state.selectedAddress) {\n    //     try {\n    //       this._rpcRequest(\n    //         { method: \"eth_accounts\", params: [] },\n    //         NOOP,\n    //         true // indicating that eth_accounts _should_ update accounts\n    //       );\n    //     } catch (_) {\n    //       // Swallow error\n    //     }\n    //   }\n    //   // Emit chainChanged event on chain change\n    //   if (\"chainId\" in state && state.chainId !== this.chainId) {\n    //     this.chainId = state.chainId || null;\n    //     this.emit(\"chainChanged\", this.chainId);\n    //     // indicate that we've connected, for EIP-1193 compliance\n    //     // we do this here so that iframe can initialize\n    //     if (!this._state.hasEmittedConnection) {\n    //       this._handleConnect(this.chainId);\n    //       this._state.hasEmittedConnection = true;\n    //     }\n    //   }\n    //   // Emit networkChanged event on network change\n    //   if (\"networkVersion\" in state && state.networkVersion !== this.networkVersion) {\n    //     this.networkVersion = state.networkVersion || null;\n    //     this.emit(\"networkChanged\", this.networkVersion);\n    //   }\n    // });\n\n    pump(mux.createStream(\"publicConfig\"), storeAsStream(this._publicConfigStore), // RPC requests should still work if only this stream fails\n    logStreamDisconnectWarning.bind(this, \"MetaMask PublicConfigStore\")); // ignore phishing warning message (handled elsewhere)\n\n    mux.ignoreStream(\"phishing\"); // setup own event listeners\n    // EIP-1193 connect\n\n    this.on(\"connect\", () => {\n      this._state.isConnected = true;\n    }); // connect to async provider\n\n    const jsonRpcConnection = createStreamMiddleware();\n    pump(jsonRpcConnection.stream, mux.createStream(jsonRpcStreamName), jsonRpcConnection.stream, this._handleStreamDisconnect.bind(this, \"MetaMask RpcProvider\")); // handle RPC requests via dapp-side rpc engine\n\n    const rpcEngine = new JRPCEngine();\n    rpcEngine.push(createIdRemapMiddleware());\n    rpcEngine.push(createErrorMiddleware());\n    rpcEngine.push(jsonRpcConnection.middleware);\n    this._rpcEngine = rpcEngine; // json rpc notification listener\n\n    jsonRpcConnection.events.on(\"notification\", payload => {\n      const {\n        method,\n        params\n      } = payload;\n\n      if (method === \"wallet_accountsChanged\") {\n        this._handleAccountsChanged(params);\n      } else if (method === \"wallet_unlockStateChanged\") {\n        this._handleUnlockStateChanged(params);\n      } else if (method === \"wallet_chainChanged\") {\n        this._handleChainChanged(params);\n      } else if (EMITTED_NOTIFICATIONS.includes(payload.method)) {\n        // EIP 1193 subscriptions, per eth-json-rpc-filters/subscriptionManager\n        this.emit(\"data\", payload); // deprecated\n\n        this.emit(\"notification\", params.result);\n        this.emit(\"message\", {\n          type: method,\n          data: params\n        });\n      } // Backward compatibility for older non EIP 1193 subscriptions\n      // this.emit('data', null, payload)\n\n    });\n  }\n\n  get publicConfigStore() {\n    if (!this._sentWarnings.publicConfigStore) {\n      log.warn(messages.warnings.publicConfigStore);\n      this._sentWarnings.publicConfigStore = true;\n    }\n\n    return this._publicConfigStore;\n  }\n  /**\n   * Returns whether the inpage provider is connected to Torus.\n   */\n\n\n  isConnected() {\n    return this._state.isConnected;\n  }\n  /**\n   * Submits an RPC request for the given method, with the given params.\n   * Resolves with the result of the method call, or rejects on error.\n   *\n   * @param args - The RPC request arguments.\n   * @returns A Promise that resolves with the result of the RPC method,\n   * or rejects if an error is encountered.\n   */\n\n\n  request(args) {\n    return __awaiter(this, void 0, void 0, function* () {\n      if (!args || typeof args !== \"object\" || Array.isArray(args)) {\n        throw ethErrors.rpc.invalidRequest({\n          message: messages.errors.invalidRequestArgs(),\n          data: args\n        });\n      }\n\n      const {\n        method,\n        params\n      } = args;\n\n      if (typeof method !== \"string\" || method.length === 0) {\n        throw ethErrors.rpc.invalidRequest({\n          message: messages.errors.invalidRequestMethod(),\n          data: args\n        });\n      }\n\n      if (params !== undefined && !Array.isArray(params) && (typeof params !== \"object\" || params === null)) {\n        throw ethErrors.rpc.invalidRequest({\n          message: messages.errors.invalidRequestParams(),\n          data: args\n        });\n      }\n\n      return new Promise((resolve, reject) => {\n        this._rpcRequest({\n          method,\n          params\n        }, getRpcPromiseCallback(resolve, reject));\n      });\n    });\n  }\n  /**\n   * Submits an RPC request per the given JSON-RPC request object.\n   *\n   * @param payload - The RPC request object.\n   * @param cb - The callback function.\n   */\n\n\n  sendAsync(payload, callback) {\n    this._rpcRequest(payload, callback);\n  }\n  /**\n   * We override the following event methods so that we can warn consumers\n   * about deprecated events:\n   *   addListener, on, once, prependListener, prependOnceListener\n   */\n\n\n  addListener(eventName, listener) {\n    this._warnOfDeprecation(eventName);\n\n    return super.addListener(eventName, listener);\n  }\n\n  on(eventName, listener) {\n    this._warnOfDeprecation(eventName);\n\n    return super.on(eventName, listener);\n  }\n\n  once(eventName, listener) {\n    this._warnOfDeprecation(eventName);\n\n    return super.once(eventName, listener);\n  }\n\n  prependListener(eventName, listener) {\n    this._warnOfDeprecation(eventName);\n\n    return super.prependListener(eventName, listener);\n  }\n\n  prependOnceListener(eventName, listener) {\n    this._warnOfDeprecation(eventName);\n\n    return super.prependOnceListener(eventName, listener);\n  } // Private Methods\n  //= ===================\n\n  /**\n   * Constructor helper.\n   * Populates initial state by calling 'wallet_getProviderState' and emits\n   * necessary events.\n   */\n\n\n  _initializeState() {\n    return __awaiter(this, void 0, void 0, function* () {\n      try {\n        const {\n          accounts,\n          chainId,\n          isUnlocked,\n          networkVersion\n        } = yield this.request({\n          method: \"wallet_getProviderState\"\n        }); // indicate that we've connected, for EIP-1193 compliance\n\n        this.emit(\"connect\", {\n          chainId\n        });\n\n        this._handleChainChanged({\n          chainId,\n          networkVersion\n        });\n\n        this._handleUnlockStateChanged({\n          accounts,\n          isUnlocked\n        });\n\n        this._handleAccountsChanged(accounts);\n      } catch (error) {\n        log.error(\"MetaMask: Failed to get initial state. Please report this bug.\", error);\n      } finally {\n        log.info(\"initialized state\");\n        this._state.initialized = true;\n        this.emit(\"_initialized\");\n      }\n    });\n  }\n  /**\n   * Internal RPC method. Forwards requests to background via the RPC engine.\n   * Also remap ids inbound and outbound.\n   *\n   * @param payload - The RPC request object.\n   * @param callback - The consumer's callback.\n   * @param isInternal - false - Whether the request is internal.\n   */\n\n\n  _rpcRequest(payload, callback) {\n    let isInternal = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : false;\n    let cb = callback;\n    const _payload = payload;\n\n    if (!Array.isArray(_payload)) {\n      if (!_payload.jsonrpc) {\n        _payload.jsonrpc = \"2.0\";\n      }\n\n      if (_payload.method === \"eth_accounts\" || _payload.method === \"eth_requestAccounts\") {\n        // handle accounts changing\n        cb = (err, res) => {\n          this._handleAccountsChanged(res.result || [], _payload.method === \"eth_accounts\", isInternal);\n\n          callback(err, res);\n        };\n      } else if (_payload.method === \"wallet_getProviderState\") {\n        this._rpcEngine.handle(payload, cb);\n\n        return;\n      }\n    }\n\n    this.tryPreopenHandle(_payload, cb);\n  }\n\n  send(methodOrPayload, callbackOrArgs) {\n    if (!this._sentWarnings.send) {\n      log.warn(messages.warnings.sendDeprecation);\n      this._sentWarnings.send = true;\n    }\n\n    if (typeof methodOrPayload === \"string\" && (!callbackOrArgs || Array.isArray(callbackOrArgs))) {\n      return new Promise((resolve, reject) => {\n        try {\n          this._rpcRequest({\n            method: methodOrPayload,\n            params: callbackOrArgs\n          }, getRpcPromiseCallback(resolve, reject, false));\n        } catch (error) {\n          reject(error);\n        }\n      });\n    }\n\n    if (methodOrPayload && typeof methodOrPayload === \"object\" && typeof callbackOrArgs === \"function\") {\n      return this._rpcRequest(methodOrPayload, callbackOrArgs);\n    }\n\n    return this._sendSync(methodOrPayload);\n  }\n  /**\n   * DEPRECATED.\n   * Internal backwards compatibility method, used in send.\n   */\n\n\n  _sendSync(payload) {\n    let result;\n\n    switch (payload.method) {\n      case \"eth_accounts\":\n        result = this.selectedAddress ? [this.selectedAddress] : [];\n        break;\n\n      case \"eth_coinbase\":\n        result = this.selectedAddress || null;\n        break;\n\n      case \"eth_uninstallFilter\":\n        this._rpcRequest(payload, NOOP);\n\n        result = true;\n        break;\n\n      case \"net_version\":\n        result = this.networkVersion || null;\n        break;\n\n      default:\n        throw new Error(messages.errors.unsupportedSync(payload.method));\n    }\n\n    return {\n      id: payload.id,\n      jsonrpc: payload.jsonrpc,\n      result\n    };\n  }\n  /**\n   * When the provider becomes connected, updates internal state and emits\n   * required events. Idempotent.\n   *\n   * @param chainId - The ID of the newly connected chain.\n   * emits MetaMaskInpageProvider#connect\n   */\n\n\n  _handleConnect(chainId) {\n    if (!this._state.isConnected) {\n      this._state.isConnected = true;\n      this.emit(\"connect\", {\n        chainId\n      });\n      log.debug(messages.info.connected(chainId));\n    }\n  }\n  /**\n   * When the provider becomes disconnected, updates internal state and emits\n   * required events. Idempotent with respect to the isRecoverable parameter.\n   *\n   * Error codes per the CloseEvent status codes as required by EIP-1193:\n   * https://developer.mozilla.org/en-US/docs/Web/API/CloseEvent#Status_codes\n   *\n   * @param isRecoverable - Whether the disconnection is recoverable.\n   * @param errorMessage - A custom error message.\n   * emits MetaMaskInpageProvider#disconnect\n   */\n\n\n  _handleDisconnect(isRecoverable, errorMessage) {\n    if (this._state.isConnected || !this._state.isPermanentlyDisconnected && !isRecoverable) {\n      this._state.isConnected = false;\n      let error;\n\n      if (isRecoverable) {\n        error = new EthereumRpcError(1013, // Try again later\n        errorMessage || messages.errors.disconnected());\n        log.debug(error);\n      } else {\n        error = new EthereumRpcError(1011, // Internal error\n        errorMessage || messages.errors.permanentlyDisconnected());\n        log.error(error);\n        this.chainId = null;\n        this._state.accounts = null;\n        this.selectedAddress = null;\n        this._state.isUnlocked = false;\n        this._state.isPermanentlyDisconnected = true;\n      }\n\n      this.emit(\"disconnect\", error);\n    }\n  }\n  /**\n   * Called when connection is lost to critical streams.\n   *\n   * emits MetamaskInpageProvider#disconnect\n   */\n\n\n  _handleStreamDisconnect(streamName, error) {\n    logStreamDisconnectWarning(streamName, error, this);\n\n    this._handleDisconnect(false, error ? error.message : undefined);\n  }\n  /**\n   * Called when accounts may have changed.\n   */\n\n\n  _handleAccountsChanged(accounts) {\n    let isEthAccounts = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;\n    let isInternal = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : false;\n    // defensive programming\n    let finalAccounts = accounts;\n\n    if (!Array.isArray(finalAccounts)) {\n      log.error(\"MetaMask: Received non-array accounts parameter. Please report this bug.\", finalAccounts);\n      finalAccounts = [];\n    }\n\n    for (const account of accounts) {\n      if (typeof account !== \"string\") {\n        log.error(\"MetaMask: Received non-string account. Please report this bug.\", accounts);\n        finalAccounts = [];\n        break;\n      }\n    } // emit accountsChanged if anything about the accounts array has changed\n\n\n    if (!dequal(this._state.accounts, finalAccounts)) {\n      // we should always have the correct accounts even before eth_accounts\n      // returns, except in cases where isInternal is true\n      if (isEthAccounts && Array.isArray(this._state.accounts) && this._state.accounts.length > 0 && !isInternal) {\n        log.error('MetaMask: \"eth_accounts\" unexpectedly updated accounts. Please report this bug.', finalAccounts);\n      }\n\n      this._state.accounts = finalAccounts;\n      this.emit(\"accountsChanged\", finalAccounts);\n    } // handle selectedAddress\n\n\n    if (this.selectedAddress !== finalAccounts[0]) {\n      this.selectedAddress = finalAccounts[0] || null;\n    }\n  }\n  /**\n   * Upon receipt of a new chainId and networkVersion, emits corresponding\n   * events and sets relevant public state.\n   * Does nothing if neither the chainId nor the networkVersion are different\n   * from existing values.\n   *\n   * emits MetamaskInpageProvider#chainChanged\n   * @param networkInfo - An object with network info.\n   */\n\n\n  _handleChainChanged() {\n    let {\n      chainId,\n      networkVersion\n    } = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n\n    if (!chainId || !networkVersion) {\n      log.error(\"MetaMask: Received invalid network parameters. Please report this bug.\", {\n        chainId,\n        networkVersion\n      });\n      return;\n    }\n\n    if (networkVersion === \"loading\") {\n      this._handleDisconnect(true);\n    } else {\n      this._handleConnect(chainId);\n\n      if (chainId !== this.chainId) {\n        this.chainId = chainId;\n\n        if (this._state.initialized) {\n          this.emit(\"chainChanged\", this.chainId);\n        }\n      }\n    }\n  }\n  /**\n   * Upon receipt of a new isUnlocked state, sets relevant public state.\n   * Calls the accounts changed handler with the received accounts, or an empty\n   * array.\n   *\n   * Does nothing if the received value is equal to the existing value.\n   * There are no lock/unlock events.\n   *\n   * @param opts - Options bag.\n   */\n\n\n  _handleUnlockStateChanged() {\n    let {\n      accounts,\n      isUnlocked\n    } = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n\n    if (typeof isUnlocked !== \"boolean\") {\n      log.error(\"MetaMask: Received invalid isUnlocked parameter. Please report this bug.\", {\n        isUnlocked\n      });\n      return;\n    }\n\n    if (isUnlocked !== this._state.isUnlocked) {\n      this._state.isUnlocked = isUnlocked;\n\n      this._handleAccountsChanged(accounts || []);\n    }\n  }\n  /**\n   * Warns of deprecation for the given event, if applicable.\n   */\n\n\n  _warnOfDeprecation(eventName) {\n    if (this._sentWarnings.events[eventName] === false) {\n      log.warn(messages.warnings.events[eventName]);\n      this._sentWarnings.events[eventName] = true;\n    }\n  }\n\n}\n\nTorusInpageProvider._defaultState = {\n  accounts: null,\n  isConnected: false,\n  isUnlocked: false,\n  initialized: false,\n  isPermanentlyDisconnected: false,\n  hasEmittedConnection: false\n};\n\nconst defaults = options => ({\n  algorithms: options.algorithms || [\"sha256\"],\n  delimiter: options.delimiter || \" \",\n  full: options.full || false\n}); // Generate list of hashes\n\n\nconst hashes = (options, data) => {\n  const internalHashes = {};\n  options.algorithms.forEach(algorithm => {\n    internalHashes[algorithm] = createHash(algorithm).update(data, \"utf8\").digest(\"base64\");\n  });\n  return internalHashes;\n}; // Build an integrity string\n\n\nconst integrity = (options, sri) => {\n  let output = \"\"; // Hash list\n\n  output += Object.keys(sri.hashes).map(algorithm => `${algorithm}-${sri.hashes[algorithm]}`).join(options.delimiter);\n  return output;\n};\n\nconst main = (options, data) => {\n  // Defaults\n  const finalOptions = defaults(options);\n  const sri = {\n    hashes: hashes(finalOptions, data),\n    integrity: undefined\n  };\n  sri.integrity = integrity(finalOptions, sri);\n  return finalOptions.full ? sri : sri.integrity;\n};\n\nclass PopupHandler extends EventEmitter {\n  constructor(_ref) {\n    let {\n      url,\n      target,\n      features\n    } = _ref;\n    super();\n    this.url = url;\n    this.target = target || \"_blank\";\n    this.features = features || getPopupFeatures();\n    this.window = undefined;\n    this.windowTimer = undefined;\n    this.iClosedWindow = false;\n\n    this._setupTimer();\n  }\n\n  _setupTimer() {\n    this.windowTimer = Number(setInterval(() => {\n      if (this.window && this.window.closed) {\n        clearInterval(this.windowTimer);\n\n        if (!this.iClosedWindow) {\n          this.emit(\"close\");\n        }\n\n        this.iClosedWindow = false;\n        this.window = undefined;\n      }\n\n      if (this.window === undefined) clearInterval(this.windowTimer);\n    }, 500));\n  }\n\n  open() {\n    var _a;\n\n    this.window = window.open(this.url.href, this.target, this.features);\n    if ((_a = this.window) === null || _a === void 0 ? void 0 : _a.focus) this.window.focus();\n    return Promise.resolve();\n  }\n\n  close() {\n    this.iClosedWindow = true;\n    if (this.window) this.window.close();\n  }\n\n  redirect(locationReplaceOnRedirect) {\n    if (locationReplaceOnRedirect) {\n      window.location.replace(this.url.href);\n    } else {\n      window.location.href = this.url.href;\n    }\n  }\n\n}\n/**\n * Returns whether the given image URL exists\n * @param url - the url of the image\n * @returns - whether the image exists\n */\n\n\nfunction imgExists(url) {\n  return new Promise((resolve, reject) => {\n    try {\n      const img = document.createElement(\"img\");\n\n      img.onload = () => resolve(true);\n\n      img.onerror = () => resolve(false);\n\n      img.src = url;\n    } catch (e) {\n      reject(e);\n    }\n  });\n}\n/**\n * Extracts a name for the site from the DOM\n */\n\n\nconst getSiteName = window => {\n  const {\n    document\n  } = window;\n  const siteName = document.querySelector('head > meta[property=\"og:site_name\"]');\n\n  if (siteName) {\n    return siteName.content;\n  }\n\n  const metaTitle = document.querySelector('head > meta[name=\"title\"]');\n\n  if (metaTitle) {\n    return metaTitle.content;\n  }\n\n  if (document.title && document.title.length > 0) {\n    return document.title;\n  }\n\n  return window.location.hostname;\n};\n/**\n * Extracts an icon for the site from the DOM\n */\n\n\nfunction getSiteIcon(window) {\n  return __awaiter(this, void 0, void 0, function* () {\n    const {\n      document\n    } = window; // Use the site's favicon if it exists\n\n    let icon = document.querySelector('head > link[rel=\"shortcut icon\"]');\n\n    if (icon && (yield imgExists(icon.href))) {\n      return icon.href;\n    } // Search through available icons in no particular order\n\n\n    icon = Array.from(document.querySelectorAll('head > link[rel=\"icon\"]')).find(_icon => Boolean(_icon.href));\n\n    if (icon && (yield imgExists(icon.href))) {\n      return icon.href;\n    }\n\n    return null;\n  });\n}\n/**\n * Gets site metadata and returns it\n *\n */\n\n\nconst getSiteMetadata = () => __awaiter(void 0, void 0, void 0, function* () {\n  return {\n    name: getSiteName(window),\n    icon: yield getSiteIcon(window)\n  };\n});\n/**\n * Sends site metadata over an RPC request.\n */\n\n\nfunction sendSiteMetadata(engine) {\n  return __awaiter(this, void 0, void 0, function* () {\n    try {\n      const domainMetadata = yield getSiteMetadata(); // call engine.handle directly to avoid normal RPC request handling\n\n      engine.handle({\n        jsonrpc: \"2.0\",\n        id: getPreopenInstanceId(),\n        method: \"wallet_sendDomainMetadata\",\n        params: domainMetadata\n      }, NOOP);\n    } catch (error) {\n      log.error({\n        message: messages.errors.sendSiteMetadata(),\n        originalError: error\n      });\n    }\n  });\n}\n\nconst defaultVerifiers = {\n  [LOGIN_PROVIDER.GOOGLE]: true,\n  [LOGIN_PROVIDER.FACEBOOK]: true,\n  [LOGIN_PROVIDER.REDDIT]: true,\n  [LOGIN_PROVIDER.TWITCH]: true,\n  [LOGIN_PROVIDER.DISCORD]: true\n};\nconst iframeIntegrity = \"sha384-S0TXaSCX5RwoXnfccta4phouwN1NNRtIFNII5DGoK4apkT5XXJ4FHPN/eFZgDxuW\";\nconst expectedCacheControlHeader = \"max-age=3600\";\nconst UNSAFE_METHODS = [\"eth_sendTransaction\", \"eth_signTypedData\", \"eth_signTypedData_v3\", \"eth_signTypedData_v4\", \"personal_sign\", \"eth_getEncryptionPublicKey\", \"eth_decrypt\"];\nconst isLocalStorageAvailable = storageAvailable(\"localStorage\"); // preload for iframe doesn't work https://bugs.chromium.org/p/chromium/issues/detail?id=593267\n\n(function preLoadIframe() {\n  return __awaiter(this, void 0, void 0, function* () {\n    try {\n      if (typeof document === \"undefined\") return;\n      const torusIframeHtml = document.createElement(\"link\");\n      const {\n        torusUrl\n      } = yield getTorusUrl(\"production\", {\n        check: false,\n        hash: iframeIntegrity,\n        version: \"\"\n      });\n      torusIframeHtml.href = `${torusUrl}/popup`;\n      torusIframeHtml.crossOrigin = \"anonymous\";\n      torusIframeHtml.type = \"text/html\";\n      torusIframeHtml.rel = \"prefetch\";\n\n      if (torusIframeHtml.relList && torusIframeHtml.relList.supports) {\n        if (torusIframeHtml.relList.supports(\"prefetch\")) {\n          document.head.appendChild(torusIframeHtml);\n        }\n      }\n    } catch (error) {\n      log.warn(error);\n    }\n  });\n})();\n\nclass Torus {\n  constructor() {\n    let {\n      buttonPosition = BUTTON_POSITION.BOTTOM_LEFT,\n      modalZIndex = 99999,\n      apiKey = \"torus-default\"\n    } = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n    this.buttonPosition = BUTTON_POSITION.BOTTOM_LEFT;\n    this.paymentProviders = configuration.paymentProviders;\n    this.buttonPosition = buttonPosition;\n    this.torusUrl = \"\";\n    this.isLoggedIn = false; // ethereum.enable working\n\n    this.isInitialized = false; // init done\n\n    this.torusWidgetVisibility = true;\n    this.requestedVerifier = \"\";\n    this.currentVerifier = \"\";\n    this.nodeDetailManager = new NodeDetailManager();\n    this.torusJs = new TorusJs({\n      metadataHost: \"https://metadata.tor.us\",\n      allowHost: \"https://signer.tor.us/api/allow\"\n    });\n    this.apiKey = apiKey;\n    TorusJs.setAPIKey(apiKey);\n    setAPIKey(apiKey);\n    this.modalZIndex = modalZIndex;\n    this.alertZIndex = modalZIndex + 1000;\n    this.isIframeFullScreen = false;\n    this.dappStorageKey = \"\";\n  }\n\n  init() {\n    let {\n      buildEnv = TORUS_BUILD_ENV.PRODUCTION,\n      enableLogging = false,\n      // deprecated: use loginConfig instead\n      enabledVerifiers = defaultVerifiers,\n      network = {\n        host: \"mainnet\",\n        chainId: null,\n        networkName: \"\",\n        blockExplorer: \"\",\n        ticker: \"\",\n        tickerName: \"\"\n      },\n      loginConfig = {},\n      showTorusButton = true,\n      integrity = {\n        check: false,\n        hash: iframeIntegrity,\n        version: \"\"\n      },\n      whiteLabel,\n      skipTKey = false,\n      useLocalStorage = false\n    } = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n    return __awaiter(this, void 0, void 0, function* () {\n      if (this.isInitialized) throw new Error(\"Already initialized\");\n      const {\n        torusUrl,\n        logLevel\n      } = yield getTorusUrl(buildEnv, integrity);\n      log.info(torusUrl, \"url loaded\");\n      this.torusUrl = torusUrl;\n      this.whiteLabel = whiteLabel;\n      log.setDefaultLevel(logLevel);\n      if (enableLogging) log.enableAll();else log.disableAll();\n      this.torusWidgetVisibility = showTorusButton;\n      let dappStorageKey = \"\";\n\n      if (isLocalStorageAvailable && useLocalStorage) {\n        const storedKey = window.localStorage.getItem(configuration.localStorageKey);\n        if (storedKey) dappStorageKey = storedKey;else {\n          const generatedKey = `torus-app-${getPreopenInstanceId()}`;\n          window.localStorage.setItem(configuration.localStorageKey, generatedKey);\n          dappStorageKey = generatedKey;\n        }\n      }\n\n      this.dappStorageKey = dappStorageKey;\n      const torusIframeUrl = new URL(torusUrl);\n      if (torusIframeUrl.pathname.endsWith(\"/\")) torusIframeUrl.pathname += \"popup\";else torusIframeUrl.pathname += \"/popup\";\n\n      if (dappStorageKey) {\n        torusIframeUrl.hash = `#dappStorageKey=${dappStorageKey}`;\n      } // Iframe code\n\n\n      this.torusIframe = htmlToElement(`<iframe\n        id=\"torusIframe\"\n        class=\"torusIframe\"\n        src=\"${torusIframeUrl.href}\"\n        style=\"display: none; position: fixed; top: 0; right: 0; width: 100%;\n        height: 100%; border: none; border-radius: 0; z-index: ${this.modalZIndex}\"\n      ></iframe>`);\n      this.torusAlertContainer = htmlToElement('<div id=\"torusAlertContainer\"></div>');\n      this.torusAlertContainer.style.display = \"none\";\n      this.torusAlertContainer.style.setProperty(\"z-index\", this.alertZIndex.toString());\n      const link = window.document.createElement(\"link\");\n      link.setAttribute(\"rel\", \"stylesheet\");\n      link.setAttribute(\"type\", \"text/css\");\n      link.setAttribute(\"href\", `${torusUrl}/css/widget.css`);\n      this.styleLink = link;\n      const {\n        defaultLanguage = getUserLanguage(),\n        customTranslations = {}\n      } = this.whiteLabel || {};\n      const mergedTranslations = deepmerge(configuration.translations, customTranslations);\n      const languageTranslations = mergedTranslations[defaultLanguage] || configuration.translations[getUserLanguage()];\n      this.embedTranslations = languageTranslations.embed;\n\n      const handleSetup = () => __awaiter(this, void 0, void 0, function* () {\n        yield documentReady();\n        return new Promise((resolve, reject) => {\n          this.torusIframe.onload = () => __awaiter(this, void 0, void 0, function* () {\n            // only do this if iframe is not full screen\n            this._setupWeb3();\n\n            const initStream = this.communicationMux.getStream(\"init_stream\");\n            initStream.on(\"data\", chunk => {\n              const {\n                name,\n                data,\n                error\n              } = chunk;\n\n              if (name === \"init_complete\" && data.success) {\n                // resolve promise\n                this.isInitialized = true;\n\n                this._displayIframe(this.isIframeFullScreen);\n\n                resolve(undefined);\n              } else if (error) {\n                reject(new Error(error));\n              }\n            });\n            initStream.write({\n              name: \"init_stream\",\n              data: {\n                enabledVerifiers,\n                loginConfig,\n                whiteLabel: this.whiteLabel,\n                buttonPosition: this.buttonPosition,\n                torusWidgetVisibility: this.torusWidgetVisibility,\n                apiKey: this.apiKey,\n                skipTKey,\n                network\n              }\n            });\n          });\n\n          window.document.head.appendChild(this.styleLink);\n          window.document.body.appendChild(this.torusIframe);\n          window.document.body.appendChild(this.torusAlertContainer);\n        });\n      });\n\n      if (buildEnv === \"production\" && integrity.check) {\n        // hacky solution to check for iframe integrity\n        const fetchUrl = `${torusUrl}/popup`;\n        const resp = yield fetch(fetchUrl, {\n          cache: \"reload\"\n        });\n\n        if (resp.headers.get(\"Cache-Control\") !== expectedCacheControlHeader) {\n          throw new Error(`Unexpected Cache-Control headers, got ${resp.headers.get(\"Cache-Control\")}`);\n        }\n\n        const response = yield resp.text();\n        const calculatedIntegrity = main({\n          algorithms: [\"sha384\"]\n        }, response);\n        log.info(calculatedIntegrity, \"integrity\");\n\n        if (calculatedIntegrity === integrity.hash) {\n          yield handleSetup();\n        } else {\n          this.clearInit();\n          throw new Error(\"Integrity check failed\");\n        }\n      } else {\n        yield handleSetup();\n      }\n\n      return undefined;\n    });\n  }\n\n  login() {\n    let {\n      verifier = \"\"\n    } = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n    if (!this.isInitialized) throw new Error(\"Call init() first\");\n    this.requestedVerifier = verifier;\n    return this.ethereum.enable();\n  }\n\n  logout() {\n    return new Promise((resolve, reject) => {\n      if (!this.isLoggedIn) {\n        reject(new Error(\"User has not logged in yet\"));\n        return;\n      }\n\n      const logOutStream = this.communicationMux.getStream(\"logout\");\n      logOutStream.write({\n        name: \"logOut\"\n      });\n      const statusStream = this.communicationMux.getStream(\"status\");\n\n      const statusStreamHandler = status => {\n        if (!status.loggedIn) {\n          this.isLoggedIn = false;\n          this.currentVerifier = \"\";\n          this.requestedVerifier = \"\";\n          resolve();\n        } else reject(new Error(\"Some Error Occured\"));\n      };\n\n      handleStream(statusStream, \"data\", statusStreamHandler);\n    });\n  }\n\n  cleanUp() {\n    return __awaiter(this, void 0, void 0, function* () {\n      if (this.isLoggedIn) {\n        yield this.logout();\n      }\n\n      this.clearInit();\n    });\n  }\n\n  clearInit() {\n    function isElement(element) {\n      return element instanceof Element || element instanceof HTMLDocument;\n    }\n\n    if (isElement(this.styleLink) && window.document.body.contains(this.styleLink)) {\n      this.styleLink.remove();\n      this.styleLink = undefined;\n    }\n\n    if (isElement(this.torusIframe) && window.document.body.contains(this.torusIframe)) {\n      this.torusIframe.remove();\n      this.torusIframe = undefined;\n    }\n\n    if (isElement(this.torusAlertContainer) && window.document.body.contains(this.torusAlertContainer)) {\n      this.torusAlert = undefined;\n      this.torusAlertContainer.remove();\n      this.torusAlertContainer = undefined;\n    }\n\n    this.isInitialized = false;\n  }\n\n  hideTorusButton() {\n    this.torusWidgetVisibility = false;\n\n    this._sendWidgetVisibilityStatus(false);\n\n    this._displayIframe();\n  }\n\n  showTorusButton() {\n    this.torusWidgetVisibility = true;\n\n    this._sendWidgetVisibilityStatus(true);\n\n    this._displayIframe();\n  }\n\n  setProvider() {\n    let _a = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n\n    var {\n      host = \"mainnet\",\n      chainId = null,\n      networkName = \"\"\n    } = _a,\n        rest = __rest(_a, [\"host\", \"chainId\", \"networkName\"]);\n\n    return new Promise((resolve, reject) => {\n      const providerChangeStream = this.communicationMux.getStream(\"provider_change\");\n\n      const handler = chunk => {\n        const {\n          err,\n          success\n        } = chunk.data;\n        log.info(chunk);\n\n        if (err) {\n          reject(err);\n        } else if (success) {\n          resolve();\n        } else reject(new Error(\"some error occured\"));\n      };\n\n      handleStream(providerChangeStream, \"data\", handler);\n      const preopenInstanceId = getPreopenInstanceId();\n\n      this._handleWindow(preopenInstanceId, {\n        target: \"_blank\",\n        features: FEATURES_PROVIDER_CHANGE_WINDOW\n      });\n\n      providerChangeStream.write({\n        name: \"show_provider_change\",\n        data: {\n          network: Object.assign({\n            host,\n            chainId,\n            networkName\n          }, rest),\n          preopenInstanceId,\n          override: false\n        }\n      });\n    });\n  }\n\n  showWallet(path) {\n    let params = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n    const showWalletStream = this.communicationMux.getStream(\"show_wallet\");\n    const finalPath = path ? `/${path}` : \"\";\n    showWalletStream.write({\n      name: \"show_wallet\",\n      data: {\n        path: finalPath\n      }\n    });\n\n    const showWalletHandler = chunk => {\n      if (chunk.name === \"show_wallet_instance\") {\n        // Let the error propogate up (hence, no try catch)\n        const {\n          instanceId\n        } = chunk.data;\n        const finalUrl = new URL(`${this.torusUrl}/wallet${finalPath}`); // Using URL constructor to prevent js injection and allow parameter validation.!\n\n        finalUrl.searchParams.append(\"integrity\", \"true\");\n        finalUrl.searchParams.append(\"instanceId\", instanceId);\n        Object.keys(params).forEach(x => {\n          finalUrl.searchParams.append(x, params[x]);\n        });\n\n        if (this.dappStorageKey) {\n          finalUrl.hash = `#dappStorageKey=${this.dappStorageKey}`;\n        }\n\n        const walletWindow = new PopupHandler({\n          url: finalUrl,\n          features: FEATURES_DEFAULT_WALLET_WINDOW\n        });\n        walletWindow.open();\n      }\n    };\n\n    handleStream(showWalletStream, \"data\", showWalletHandler);\n  }\n\n  getPublicAddress(_ref2) {\n    let {\n      verifier,\n      verifierId,\n      isExtended = false\n    } = _ref2;\n    return __awaiter(this, void 0, void 0, function* () {\n      if (!configuration.supportedVerifierList.includes(verifier) || !WALLET_OPENLOGIN_VERIFIER_MAP[verifier]) throw new Error(\"Unsupported verifier\");\n      const nodeDetails = yield this.nodeDetailManager.getNodeDetails(false, true);\n      const endpoints = nodeDetails.torusNodeEndpoints;\n      const torusNodePubs = nodeDetails.torusNodePub;\n      const walletVerifier = verifier;\n      const openloginVerifier = WALLET_OPENLOGIN_VERIFIER_MAP[verifier];\n\n      try {\n        const existingV1User = yield this.torusJs.getUserTypeAndAddress(endpoints, torusNodePubs, {\n          verifier: walletVerifier,\n          verifierId\n        });\n\n        if (existingV1User.typeOfUser === \"v1\") {\n          if (!isExtended) return existingV1User.address;\n          return existingV1User;\n        } // we don't support v2 users with v1 verifiers so get or assign the key for v2 user on v2 `verifier`\n\n\n        const v2User = yield this.torusJs.getUserTypeAndAddress(endpoints, torusNodePubs, {\n          verifier: openloginVerifier,\n          verifierId\n        }, true);\n        if (!isExtended) return v2User.address;\n        return v2User;\n      } catch (error) {\n        if (error === null || error === void 0 ? void 0 : error.message.includes(\"Verifier + VerifierID has not yet been assigned\")) {\n          // if user doesn't have key then assign it with v2 verifier\n          const newV2User = yield this.torusJs.getUserTypeAndAddress(endpoints, torusNodePubs, {\n            verifier: openloginVerifier,\n            verifierId\n          }, true);\n          if (!isExtended) return newV2User.address;\n          return newV2User;\n        }\n\n        throw error;\n      }\n    });\n  }\n\n  getUserInfo(message) {\n    return new Promise((resolve, reject) => {\n      if (this.isLoggedIn) {\n        const userInfoAccessStream = this.communicationMux.getStream(\"user_info_access\");\n        userInfoAccessStream.write({\n          name: \"user_info_access_request\"\n        });\n\n        const userInfoAccessHandler = chunk => {\n          const {\n            name,\n            data: {\n              approved,\n              payload,\n              rejected,\n              newRequest\n            }\n          } = chunk;\n\n          if (name === \"user_info_access_response\") {\n            if (approved) {\n              resolve(payload);\n            } else if (rejected) {\n              reject(new Error(\"User rejected the request\"));\n            } else if (newRequest) {\n              const userInfoStream = this.communicationMux.getStream(\"user_info\");\n\n              const userInfoHandler = handlerChunk => {\n                if (handlerChunk.name === \"user_info_response\") {\n                  if (handlerChunk.data.approved) {\n                    resolve(handlerChunk.data.payload);\n                  } else {\n                    reject(new Error(\"User rejected the request\"));\n                  }\n                }\n              };\n\n              handleStream(userInfoStream, \"data\", userInfoHandler);\n              const preopenInstanceId = getPreopenInstanceId();\n\n              this._handleWindow(preopenInstanceId, {\n                target: \"_blank\",\n                features: FEATURES_PROVIDER_CHANGE_WINDOW\n              });\n\n              userInfoStream.write({\n                name: \"user_info_request\",\n                data: {\n                  message,\n                  preopenInstanceId\n                }\n              });\n            }\n          }\n        };\n\n        handleStream(userInfoAccessStream, \"data\", userInfoAccessHandler);\n      } else reject(new Error(\"User has not logged in yet\"));\n    });\n  }\n\n  initiateTopup(provider, params) {\n    return new Promise((resolve, reject) => {\n      if (this.isInitialized) {\n        const {\n          errors,\n          isValid\n        } = validatePaymentProvider(provider, params);\n\n        if (!isValid) {\n          reject(new Error(JSON.stringify(errors)));\n          return;\n        }\n\n        const topupStream = this.communicationMux.getStream(\"topup\");\n\n        const topupHandler = chunk => {\n          if (chunk.name === \"topup_response\") {\n            if (chunk.data.success) {\n              resolve(chunk.data.success);\n            } else {\n              reject(new Error(chunk.data.error));\n            }\n          }\n        };\n\n        handleStream(topupStream, \"data\", topupHandler);\n        const preopenInstanceId = getPreopenInstanceId();\n\n        this._handleWindow(preopenInstanceId);\n\n        topupStream.write({\n          name: \"topup_request\",\n          data: {\n            provider,\n            params,\n            preopenInstanceId\n          }\n        });\n      } else reject(new Error(\"Torus is not initialized yet\"));\n    });\n  }\n\n  _handleWindow(preopenInstanceId) {\n    let {\n      url,\n      target,\n      features\n    } = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n\n    if (preopenInstanceId) {\n      const windowStream = this.communicationMux.getStream(\"window\");\n      const finalUrl = new URL(url || `${this.torusUrl}/redirect?preopenInstanceId=${preopenInstanceId}`);\n\n      if (this.dappStorageKey) {\n        // If multiple instances, it returns the first one\n        if (finalUrl.hash) finalUrl.hash += `&dappStorageKey=${this.dappStorageKey}`;else finalUrl.hash = `#dappStorageKey=${this.dappStorageKey}`;\n      }\n\n      const handledWindow = new PopupHandler({\n        url: finalUrl,\n        target,\n        features\n      });\n      handledWindow.open();\n\n      if (!handledWindow.window) {\n        this._createPopupBlockAlert(preopenInstanceId, finalUrl.href);\n\n        return;\n      }\n\n      windowStream.write({\n        name: \"opened_window\",\n        data: {\n          preopenInstanceId\n        }\n      });\n\n      const closeHandler = _ref3 => {\n        let {\n          preopenInstanceId: receivedId,\n          close\n        } = _ref3;\n\n        if (receivedId === preopenInstanceId && close) {\n          handledWindow.close();\n          windowStream.removeListener(\"data\", closeHandler);\n        }\n      };\n\n      windowStream.on(\"data\", closeHandler);\n      handledWindow.once(\"close\", () => {\n        windowStream.write({\n          data: {\n            preopenInstanceId,\n            closed: true\n          }\n        });\n        windowStream.removeListener(\"data\", closeHandler);\n      });\n    }\n  }\n\n  _setEmbedWhiteLabel(element) {\n    // Set whitelabel\n    const {\n      theme\n    } = this.whiteLabel || {};\n\n    if (theme) {\n      const {\n        isDark = false,\n        colors = {}\n      } = theme;\n      if (isDark) element.classList.add(\"torus-dark\");\n      if (colors.torusBrand1) element.style.setProperty(\"--torus-brand-1\", colors.torusBrand1);\n      if (colors.torusGray2) element.style.setProperty(\"--torus-gray-2\", colors.torusGray2);\n    }\n  }\n\n  _getLogoUrl() {\n    var _a, _b, _c, _d;\n\n    let logoUrl = `${this.torusUrl}/images/torus_icon-blue.svg`;\n\n    if ((_b = (_a = this.whiteLabel) === null || _a === void 0 ? void 0 : _a.theme) === null || _b === void 0 ? void 0 : _b.isDark) {\n      logoUrl = ((_c = this.whiteLabel) === null || _c === void 0 ? void 0 : _c.logoLight) || logoUrl;\n    } else {\n      logoUrl = ((_d = this.whiteLabel) === null || _d === void 0 ? void 0 : _d.logoDark) || logoUrl;\n    }\n\n    return logoUrl;\n  }\n\n  _sendWidgetVisibilityStatus(status) {\n    const torusWidgetVisibilityStream = this.communicationMux.getStream(\"torus-widget-visibility\");\n    torusWidgetVisibilityStream.write({\n      data: status\n    });\n  }\n\n  _displayIframe() {\n    let isFull = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : false;\n    const style = {}; // set phase\n\n    if (!isFull) {\n      style.display = this.torusWidgetVisibility ? \"block\" : \"none\";\n      style.height = \"70px\";\n      style.width = \"70px\";\n\n      switch (this.buttonPosition) {\n        case BUTTON_POSITION.TOP_LEFT:\n          style.top = \"0px\";\n          style.left = \"0px\";\n          style.right = \"auto\";\n          style.bottom = \"auto\";\n          break;\n\n        case BUTTON_POSITION.TOP_RIGHT:\n          style.top = \"0px\";\n          style.right = \"0px\";\n          style.left = \"auto\";\n          style.bottom = \"auto\";\n          break;\n\n        case BUTTON_POSITION.BOTTOM_RIGHT:\n          style.bottom = \"0px\";\n          style.right = \"0px\";\n          style.top = \"auto\";\n          style.left = \"auto\";\n          break;\n\n        case BUTTON_POSITION.BOTTOM_LEFT:\n        default:\n          style.bottom = \"0px\";\n          style.left = \"0px\";\n          style.top = \"auto\";\n          style.right = \"auto\";\n          break;\n      }\n    } else {\n      style.display = \"block\";\n      style.width = \"100%\";\n      style.height = \"100%\";\n      style.top = \"0px\";\n      style.right = \"0px\";\n      style.left = \"0px\";\n      style.bottom = \"0px\";\n    }\n\n    Object.assign(this.torusIframe.style, style);\n    this.isIframeFullScreen = isFull;\n  }\n\n  _setupWeb3() {\n    log.info(\"setupWeb3 running\"); // setup background connection\n\n    const metamaskStream = new BasePostMessageStream({\n      name: \"embed_metamask\",\n      target: \"iframe_metamask\",\n      targetWindow: this.torusIframe.contentWindow,\n      targetOrigin: new URL(this.torusUrl).origin\n    }); // Due to compatibility reasons, we should not set up multiplexing on window.metamaskstream\n    // because the MetamaskInpageProvider also attempts to do so.\n    // We create another LocalMessageDuplexStream for communication between dapp <> iframe\n\n    const communicationStream = new BasePostMessageStream({\n      name: \"embed_comm\",\n      target: \"iframe_comm\",\n      targetWindow: this.torusIframe.contentWindow,\n      targetOrigin: new URL(this.torusUrl).origin\n    }); // Backward compatibility with Gotchi :)\n    // window.metamaskStream = this.communicationStream\n    // compose the inpage provider\n\n    const inpageProvider = new TorusInpageProvider(metamaskStream); // detect eth_requestAccounts and pipe to enable for now\n\n    const detectAccountRequestPrototypeModifier = m => {\n      const originalMethod = inpageProvider[m];\n\n      inpageProvider[m] = function providerFunc(method) {\n        if (method && method === \"eth_requestAccounts\") {\n          return inpageProvider.enable();\n        }\n\n        for (var _len2 = arguments.length, args = new Array(_len2 > 1 ? _len2 - 1 : 0), _key2 = 1; _key2 < _len2; _key2++) {\n          args[_key2 - 1] = arguments[_key2];\n        }\n\n        return originalMethod.apply(this, [method, ...args]);\n      };\n    };\n\n    detectAccountRequestPrototypeModifier(\"send\");\n    detectAccountRequestPrototypeModifier(\"sendAsync\");\n\n    inpageProvider.enable = () => {\n      return new Promise((resolve, reject) => {\n        // If user is already logged in, we assume they have given access to the website\n        inpageProvider.sendAsync({\n          jsonrpc: \"2.0\",\n          id: getPreopenInstanceId(),\n          method: \"eth_requestAccounts\",\n          params: []\n        }, (err, response) => {\n          const {\n            result: res\n          } = response || {};\n\n          if (err) {\n            setTimeout(() => {\n              reject(err);\n            }, 50);\n          } else if (Array.isArray(res) && res.length > 0) {\n            // If user is already rehydrated, resolve this\n            // else wait for something to be written to status stream\n            const handleLoginCb = () => {\n              if (this.requestedVerifier !== \"\" && this.currentVerifier !== this.requestedVerifier) {\n                const {\n                  requestedVerifier\n                } = this; // eslint-disable-next-line promise/no-promise-in-callback\n\n                this.logout() // eslint-disable-next-line promise/always-return\n                .then(_ => {\n                  this.requestedVerifier = requestedVerifier;\n\n                  this._showLoginPopup(true, resolve, reject);\n                }).catch(error => reject(error));\n              } else {\n                resolve(res);\n              }\n            };\n\n            if (this.isLoggedIn) {\n              handleLoginCb();\n            } else {\n              this.isLoginCallback = handleLoginCb;\n            }\n          } else {\n            // set up listener for login\n            this._showLoginPopup(true, resolve, reject);\n          }\n        });\n      });\n    };\n\n    inpageProvider.tryPreopenHandle = (payload, cb) => {\n      const _payload = payload;\n\n      if (!Array.isArray(_payload) && UNSAFE_METHODS.includes(_payload.method)) {\n        const preopenInstanceId = getPreopenInstanceId();\n\n        this._handleWindow(preopenInstanceId, {\n          target: \"_blank\",\n          features: FEATURES_CONFIRM_WINDOW\n        });\n\n        _payload.preopenInstanceId = preopenInstanceId;\n      }\n\n      inpageProvider._rpcEngine.handle(_payload, cb);\n    }; // Work around for web3@1.0 deleting the bound `sendAsync` but not the unbound\n    // `sendAsync` method on the prototype, causing `this` reference issues with drizzle\n\n\n    const proxiedInpageProvider = new Proxy(inpageProvider, {\n      // straight up lie that we deleted the property so that it doesnt\n      // throw an error in strict mode\n      deleteProperty: () => true\n    });\n    this.ethereum = proxiedInpageProvider;\n    const communicationMux = setupMultiplex(communicationStream);\n    this.communicationMux = communicationMux;\n    const windowStream = communicationMux.getStream(\"window\");\n    windowStream.on(\"data\", chunk => {\n      if (chunk.name === \"create_window\") {\n        // url is the url we need to open\n        // we can pass the final url upfront so that it removes the step of redirecting to /redirect and waiting for finalUrl\n        this._createPopupBlockAlert(chunk.data.preopenInstanceId, chunk.data.url);\n      }\n    }); // show torus widget if button clicked\n\n    const widgetStream = communicationMux.getStream(\"widget\");\n    widgetStream.on(\"data\", chunk => {\n      const {\n        data\n      } = chunk;\n\n      this._displayIframe(data);\n    }); // Show torus button if wallet has been hydrated/detected\n\n    const statusStream = communicationMux.getStream(\"status\");\n    statusStream.on(\"data\", status => {\n      // login\n      if (status.loggedIn) {\n        this.isLoggedIn = status.loggedIn;\n        this.currentVerifier = status.verifier;\n      } // logout\n      else this._displayIframe();\n\n      if (this.isLoginCallback) {\n        this.isLoginCallback();\n        delete this.isLoginCallback;\n      }\n    });\n    this.provider = proxiedInpageProvider;\n    if (this.provider.shouldSendMetadata) sendSiteMetadata(this.provider._rpcEngine);\n\n    inpageProvider._initializeState();\n\n    log.debug(\"Torus - injected provider\");\n  }\n\n  _showLoginPopup(calledFromEmbed, resolve, reject) {\n    const loginHandler = data => {\n      const {\n        err,\n        selectedAddress\n      } = data;\n\n      if (err) {\n        log.error(err);\n        if (reject) reject(err);\n      } // returns an array (cause accounts expects it)\n      else if (resolve) resolve([selectedAddress]);\n\n      if (this.isIframeFullScreen) this._displayIframe();\n    };\n\n    const oauthStream = this.communicationMux.getStream(\"oauth\");\n\n    if (!this.requestedVerifier) {\n      this._displayIframe(true);\n\n      handleStream(oauthStream, \"data\", loginHandler);\n      oauthStream.write({\n        name: \"oauth_modal\",\n        data: {\n          calledFromEmbed\n        }\n      });\n    } else {\n      handleStream(oauthStream, \"data\", loginHandler);\n      const preopenInstanceId = getPreopenInstanceId();\n\n      this._handleWindow(preopenInstanceId);\n\n      oauthStream.write({\n        name: \"oauth\",\n        data: {\n          calledFromEmbed,\n          verifier: this.requestedVerifier,\n          preopenInstanceId\n        }\n      });\n    }\n  }\n\n  _createPopupBlockAlert(preopenInstanceId, url) {\n    const logoUrl = this._getLogoUrl();\n\n    const torusAlert = htmlToElement('<div id=\"torusAlert\" class=\"torus-alert--v2\">' + `<div id=\"torusAlert__logo\"><img src=\"${logoUrl}\" /></div>` + \"<div>\" + `<h1 id=\"torusAlert__title\">${this.embedTranslations.actionRequired}</h1>` + `<p id=\"torusAlert__desc\">${this.embedTranslations.pendingAction}</p>` + \"</div>\" + \"</div>\");\n    const successAlert = htmlToElement(`<div><a id=\"torusAlert__btn\">${this.embedTranslations.continue}</a></div>`);\n    const btnContainer = htmlToElement('<div id=\"torusAlert__btn-container\"></div>');\n    btnContainer.appendChild(successAlert);\n    torusAlert.appendChild(btnContainer);\n\n    const bindOnLoad = () => {\n      successAlert.addEventListener(\"click\", () => {\n        this._handleWindow(preopenInstanceId, {\n          url,\n          target: \"_blank\",\n          features: FEATURES_CONFIRM_WINDOW\n        });\n\n        torusAlert.remove();\n        if (this.torusAlertContainer.children.length === 0) this.torusAlertContainer.style.display = \"none\";\n      });\n    };\n\n    this._setEmbedWhiteLabel(torusAlert);\n\n    const attachOnLoad = () => {\n      this.torusAlertContainer.style.display = \"block\";\n      this.torusAlertContainer.appendChild(torusAlert);\n    };\n\n    runOnLoad(attachOnLoad);\n    runOnLoad(bindOnLoad);\n  }\n\n}\n\nexport { BUTTON_POSITION, LOGIN_PROVIDER, PAYMENT_PROVIDER, TORUS_BUILD_ENV, TorusInpageProvider, WALLET_OPENLOGIN_VERIFIER_MAP, Torus as default };","map":{"version":3,"sources":["../node_modules/tslib/tslib.es6.js","../src/interfaces.ts","../src/config.ts","../src/embedUtils.ts","../src/loglevel.ts","../src/messages.ts","../src/utils.ts","../src/inpage-provider.ts","../src/integrity.ts","../src/PopupHandler.ts","../src/siteMetadata.ts","../src/embed.ts"],"names":["paymentProviders","config","generateIntegrity"],"mappings":"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","sourcesContent":["/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation.\r\n\r\nPermission to use, copy, modify, and/or distribute this software for any\r\npurpose with or without fee is hereby granted.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\r\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\r\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\r\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\r\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\r\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\r\nPERFORMANCE OF THIS SOFTWARE.\r\n***************************************************************************** */\r\n/* global Reflect, Promise */\r\n\r\nvar extendStatics = function(d, b) {\r\n    extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n    return extendStatics(d, b);\r\n};\r\n\r\nexport function __extends(d, b) {\r\n    extendStatics(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n}\r\n\r\nexport var __assign = function() {\r\n    __assign = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    }\r\n    return __assign.apply(this, arguments);\r\n}\r\n\r\nexport function __rest(s, e) {\r\n    var t = {};\r\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n        t[p] = s[p];\r\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\r\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\r\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\r\n                t[p[i]] = s[p[i]];\r\n        }\r\n    return t;\r\n}\r\n\r\nexport function __decorate(decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n}\r\n\r\nexport function __param(paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n}\r\n\r\nexport function __metadata(metadataKey, metadataValue) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\r\n}\r\n\r\nexport function __awaiter(thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\r\n\r\nexport function __generator(thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n}\r\n\r\nexport function __createBinding(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    o[k2] = m[k];\r\n}\r\n\r\nexport function __exportStar(m, exports) {\r\n    for (var p in m) if (p !== \"default\" && !exports.hasOwnProperty(p)) exports[p] = m[p];\r\n}\r\n\r\nexport function __values(o) {\r\n    var s = typeof Symbol === \"function\" && Symbol.iterator, m = s && o[s], i = 0;\r\n    if (m) return m.call(o);\r\n    if (o && typeof o.length === \"number\") return {\r\n        next: function () {\r\n            if (o && i >= o.length) o = void 0;\r\n            return { value: o && o[i++], done: !o };\r\n        }\r\n    };\r\n    throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");\r\n}\r\n\r\nexport function __read(o, n) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\r\n    if (!m) return o;\r\n    var i = m.call(o), r, ar = [], e;\r\n    try {\r\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\r\n    }\r\n    catch (error) { e = { error: error }; }\r\n    finally {\r\n        try {\r\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\r\n        }\r\n        finally { if (e) throw e.error; }\r\n    }\r\n    return ar;\r\n}\r\n\r\nexport function __spread() {\r\n    for (var ar = [], i = 0; i < arguments.length; i++)\r\n        ar = ar.concat(__read(arguments[i]));\r\n    return ar;\r\n}\r\n\r\nexport function __spreadArrays() {\r\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\r\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\r\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\r\n            r[k] = a[j];\r\n    return r;\r\n};\r\n\r\nexport function __await(v) {\r\n    return this instanceof __await ? (this.v = v, this) : new __await(v);\r\n}\r\n\r\nexport function __asyncGenerator(thisArg, _arguments, generator) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var g = generator.apply(thisArg, _arguments || []), i, q = [];\r\n    return i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i;\r\n    function verb(n) { if (g[n]) i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; }\r\n    function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\r\n    function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }\r\n    function fulfill(value) { resume(\"next\", value); }\r\n    function reject(value) { resume(\"throw\", value); }\r\n    function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\r\n}\r\n\r\nexport function __asyncDelegator(o) {\r\n    var i, p;\r\n    return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\r\n    function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: n === \"return\" } : f ? f(v) : v; } : f; }\r\n}\r\n\r\nexport function __asyncValues(o) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var m = o[Symbol.asyncIterator], i;\r\n    return m ? m.call(o) : (o = typeof __values === \"function\" ? __values(o) : o[Symbol.iterator](), i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i);\r\n    function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }\r\n    function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }\r\n}\r\n\r\nexport function __makeTemplateObject(cooked, raw) {\r\n    if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\r\n    return cooked;\r\n};\r\n\r\nexport function __importStar(mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (Object.hasOwnProperty.call(mod, k)) result[k] = mod[k];\r\n    result.default = mod;\r\n    return result;\r\n}\r\n\r\nexport function __importDefault(mod) {\r\n    return (mod && mod.__esModule) ? mod : { default: mod };\r\n}\r\n\r\nexport function __classPrivateFieldGet(receiver, privateMap) {\r\n    if (!privateMap.has(receiver)) {\r\n        throw new TypeError(\"attempted to get private field on non-instance\");\r\n    }\r\n    return privateMap.get(receiver);\r\n}\r\n\r\nexport function __classPrivateFieldSet(receiver, privateMap, value) {\r\n    if (!privateMap.has(receiver)) {\r\n        throw new TypeError(\"attempted to set private field on non-instance\");\r\n    }\r\n    privateMap.set(receiver, value);\r\n    return value;\r\n}\r\n",null,null,null,null,null,null,null,null,null,null,null]},"metadata":{},"sourceType":"module"}