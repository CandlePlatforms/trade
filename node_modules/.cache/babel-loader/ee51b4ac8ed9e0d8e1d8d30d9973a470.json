{"ast":null,"code":"var _jsxFileName = \"/Users/safahi/Desktop/webapp-v2-feature-gtm_events/src/elements/swapLimit/SwapLimit.tsx\",\n    _s = $RefreshSig$();\n\nimport { useCallback, useEffect, useMemo, useRef, useState } from 'react';\nimport dayjs from 'utils/dayjs';\nimport BigNumber from 'bignumber.js';\nimport { InputField } from 'components/inputField/InputField';\nimport { TokenInputField } from 'components/tokenInputField/TokenInputField';\nimport { ModalDuration } from 'elements/modalDuration/modalDuration';\nimport { ReactComponent as IconSync } from \"@svgr/webpack?-svgo,+titleProp,+ref!assets/icons/sync.svg\";\nimport { classNameGenerator } from 'utils/pureFunctions';\nimport { getRate } from 'services/web3/swap/market';\nimport { swapLimit } from 'services/api/keeperDao';\nimport { addNotification, NotificationType } from 'redux/notification/notification';\nimport { useDispatch } from 'react-redux';\nimport { useWeb3React } from '@web3-react/core';\nimport { ethToken, wethToken } from 'services/web3/config';\nimport { useAppSelector } from 'redux/index';\nimport { openWalletModal } from 'redux/user/user';\nimport { ModalApprove } from 'elements/modalApprove/modalApprove';\nimport { ApprovalContract, getNetworkContractApproval } from 'services/web3/approval';\nimport { prettifyNumber } from 'utils/helperFunctions';\nimport { ConversionEvents, sendConversionEvent, setCurrentConversion } from 'services/api/googleTagManager';\nimport { updateTokens } from 'redux/bancor/bancor';\nimport { fetchTokenBalances } from 'services/observables/balances';\nimport { wait } from 'utils/pureFunctions';\nimport { calculatePercentageChange } from 'utils/formulas';\nimport { ModalDepositETH } from 'elements/modalDepositETH/modalDepositETH';\nimport useAsyncEffect from 'use-async-effect';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nvar Field;\n\n(function (Field) {\n  Field[Field[\"from\"] = 0] = \"from\";\n  Field[Field[\"to\"] = 1] = \"to\";\n  Field[Field[\"rate\"] = 2] = \"rate\";\n})(Field || (Field = {}));\n\nexport const SwapLimit = _ref => {\n  _s();\n\n  let {\n    fromToken,\n    setFromToken,\n    toToken,\n    setToToken,\n    switchTokens,\n    refreshLimit\n  } = _ref;\n  const dispatch = useDispatch();\n  const {\n    chainId\n  } = useWeb3React();\n  const account = useAppSelector(state => state.user.account);\n  const [fromAmount, setFromAmount] = useState('');\n  const [toAmount, setToAmount] = useState('');\n  const [toAmountUsd, setToAmountUsd] = useState('');\n  const [fromAmountUsd, setFromAmountUsd] = useState('');\n  const [rate, setRate] = useState('');\n  const [marketRate, setMarketRate] = useState(-1);\n  const [percentage, setPercentage] = useState('');\n  const [selPercentage, setSelPercentage] = useState(1);\n  const [showApproveModal, setShowApproveModal] = useState(false);\n  const [showEthModal, setShowEthModal] = useState(false);\n  const [fromError, setFromError] = useState('');\n  const [rateWarning, setRateWarning] = useState({\n    type: '',\n    msg: ''\n  });\n  const [isLoadingRate, setIsLoadingRate] = useState(false);\n  const [duration, setDuration] = useState(dayjs.duration({\n    days: 7,\n    hours: 0,\n    minutes: 0\n  }));\n  const previousField = useRef();\n  const lastChangedField = useRef();\n  const tokens = useAppSelector(state => state.bancor.tokens);\n  const keeperDaoTokens = useAppSelector(state => state.bancor.keeperDaoTokens);\n  const fiatToggle = useAppSelector(state => state.user.usdToggle);\n  const percentages = useMemo(() => [1, 3, 5], []);\n  const calculatePercentageByRate = useCallback((marketRate, rate) => {\n    const percentage = calculatePercentageChange(Number(rate), marketRate);\n    const index = percentages.indexOf(percentage);\n\n    if (index === -1) {\n      setPercentage(percentage.toFixed(2));\n      setSelPercentage(-1);\n    } else {\n      setPercentage('');\n      setSelPercentage(index);\n    }\n  }, [percentages]);\n  const calcFrom = useCallback((to, rate) => {\n    if (rate && to) {\n      const amount = new BigNumber(to).div(rate);\n      setFromAmount(amount.toString());\n      const usdAmount = amount.times(fromToken.usdPrice).toString();\n      setFromAmountUsd(usdAmount);\n    }\n  }, [fromToken]);\n  const calcTo = useCallback((from, rate) => {\n    if (rate && from && toToken) {\n      const amount = new BigNumber(rate).times(from);\n      setToAmount(amount.toString());\n      const usdAmount = amount.times(toToken.usdPrice).toString();\n      setToAmountUsd(usdAmount);\n    }\n  }, [toToken]);\n  const calcRate = useCallback((from, to) => {\n    if (from && to) {\n      const rate = new BigNumber(to).div(from).toString();\n      setRate(rate);\n      calculatePercentageByRate(marketRate, rate);\n    }\n  }, [calculatePercentageByRate, marketRate]);\n  const handleFieldChanged = useCallback((field, from, to, rate) => {\n    if (previousField.current !== lastChangedField.current && lastChangedField.current !== field) previousField.current = lastChangedField.current;\n    lastChangedField.current = field;\n\n    switch (field) {\n      case Field.from:\n        if (previousField.current === Field.to) calcRate(from, to);else calcTo(from, rate);\n        break;\n\n      case Field.to:\n        if (previousField.current === Field.from) calcRate(from, to);else calcFrom(to, rate);\n        break;\n\n      case Field.rate:\n        const isTooHigh = new BigNumber(rate).lt(marketRate);\n        const isTooLow = new BigNumber(marketRate).times(1.2).lt(rate);\n\n        if (isTooHigh) {\n          setRateWarning({\n            type: 'error',\n            msg: 'Pay attention! The rate is lower than market rate, you can get a better rate on market swap'\n          });\n        } else if (isTooLow) {\n          setRateWarning({\n            type: 'warning',\n            msg: 'Pay attention! The rate is too high above market rate and will likely not be fulfilled'\n          });\n        } else {\n          setRateWarning({\n            type: '',\n            msg: ''\n          });\n        }\n\n        if (previousField.current === Field.from) calcTo(from, rate);else calcFrom(to, rate);\n        break;\n    }\n  }, [calcRate, calcTo, calcFrom, marketRate]);\n\n  const calculateRateByMarket = (marketRate, selPercentage, percentage) => {\n    const perc = selPercentage === -1 ? Number(percentage) / 100 : percentages[selPercentage] / 100;\n    const rate = (marketRate * (1 + perc)).toFixed(6);\n    handleFieldChanged(Field.rate, fromAmount, toAmount, rate);\n    setRate(rate);\n  };\n\n  useAsyncEffect(async isMounted => {\n    if (!fromToken || !toToken) return;\n    if (toToken.address === ethToken && fromToken.address === wethToken) return;\n\n    if (isMounted()) {\n      setIsLoadingRate(true);\n      const rate = Number(await getRate(fromToken, toToken, '1'));\n      setMarketRate(rate);\n      calculateRateByMarket(rate, 1, '');\n      setIsLoadingRate(false);\n      setRateWarning({\n        type: '',\n        msg: ''\n      });\n    }\n  }, [toToken === null || toToken === void 0 ? void 0 : toToken.address, fromToken === null || fromToken === void 0 ? void 0 : fromToken.address]); //Check if approval is required\n\n  const checkApproval = async token => {\n    try {\n      const isApprovalReq = await getNetworkContractApproval(token, ApprovalContract.ExchangeProxy, fromAmount);\n\n      if (isApprovalReq) {\n        sendConversionEvent(ConversionEvents.approvePop);\n        setShowApproveModal(true);\n      } else await handleSwap(true, token.address === wethToken);\n    } catch (e) {\n      dispatch(addNotification({\n        type: NotificationType.error,\n        title: 'Transaction Failed',\n        msg: `${token.symbol} approval had failed. Please try again or contact support.`\n      }));\n    }\n  };\n\n  const updateETHandWETH = async () => {\n    if (!(chainId && toToken && account)) return;\n    const weth = tokens.find(x => x.address === wethToken);\n    await wait(4000);\n    const balances = await fetchTokenBalances(weth ? [fromToken, weth] : [fromToken], account);\n    dispatch(updateTokens(balances));\n  };\n\n  const handleSwap = async function () {\n    let approved = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : false;\n    let weth = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;\n    let showETHtoWETHModal = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : false;\n\n    if (!account) {\n      dispatch(openWalletModal(true));\n      return;\n    }\n\n    if (!(fromToken && toToken && fromAmount && toAmount)) return;\n    if (showETHtoWETHModal) return setShowEthModal(true);\n    if (!approved) return checkApproval(fromToken);\n    const notification = await swapLimit(weth ? { ...fromToken,\n      address: wethToken\n    } : fromToken, toToken, fromAmount, toAmount, account, duration, checkApproval);\n    if (notification) dispatch(addNotification(notification));\n    if (fromToken.address === ethToken) updateETHandWETH();\n    refreshLimit();\n  };\n\n  const isSwapDisabled = () => {\n    if (isLoadingRate) return true;\n    if (fromError !== '') return true;\n    if (fromAmount === '' || toAmount === '' || rate === '' || new BigNumber(fromAmount).eq(0) || new BigNumber(toAmount).eq(0) || new BigNumber(rate).eq(0)) return true;\n    if (!toToken) return true;\n    if (!account) return false;\n    if (toToken.address === ethToken || keeperDaoTokens.findIndex(x => x.address === toToken.address) === -1 || fromToken.address !== ethToken && keeperDaoTokens.findIndex(x => x.address === fromToken.address) === -1) return true;\n    return false;\n  }; // handle input errors\n\n\n  useEffect(() => {\n    const isInsufficient = fromToken && fromToken.balance && new BigNumber(fromAmount).gt(fromToken.balance);\n    if (isInsufficient) setFromError('Token balance is currently insufficient');else setFromError('');\n  }, [fromAmount, fromToken]);\n\n  const handleRateInput = val => {\n    setRate(val);\n    calculatePercentageByRate(marketRate, val);\n    handleFieldChanged(Field.rate, fromAmount, toAmount, val);\n  };\n\n  const swapButtonText = () => {\n    if (!toToken) return 'Select a token';else if (fromToken.address !== ethToken && keeperDaoTokens.findIndex(x => x.address === fromToken.address) === -1) return `${fromToken.symbol} token is not supported`;\n    if (toToken.address === ethToken) return 'Please change ETH to WETH';else if (keeperDaoTokens.findIndex(x => x.address === toToken.address) === -1) return `${toToken.symbol} token is not supported`;\n    return 'Trade';\n  };\n\n  const handleSwapClick = () => {\n    const tokenPair = fromToken.symbol + '/' + (toToken === null || toToken === void 0 ? void 0 : toToken.symbol);\n    setCurrentConversion('Limit', chainId, tokenPair, fromToken.symbol, toToken === null || toToken === void 0 ? void 0 : toToken.symbol, fromAmount, fromAmountUsd, toAmount, toAmountUsd, fiatToggle, rate, percentage, duration.asSeconds().toString());\n    sendConversionEvent(ConversionEvents.click);\n    handleSwap(false, false, fromToken.address === ethToken);\n  };\n\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"px-20\",\n      children: /*#__PURE__*/_jsxDEV(TokenInputField, {\n        label: \"You Pay\",\n        token: fromToken,\n        setToken: setFromToken,\n        input: fromAmount,\n        amountUsd: fromAmountUsd,\n        setAmountUsd: setFromAmountUsd,\n        onChange: val => {\n          setFromAmount(val);\n          handleFieldChanged(Field.from, val, toAmount, rate);\n        },\n        border: true,\n        selectable: true,\n        excludedTokens: toToken ? [toToken.address, ...(toToken.address === ethToken || toToken.address === wethToken ? [ethToken, wethToken] : [])] : [],\n        errorMsg: fromError,\n        includedTokens: [ethToken, ...keeperDaoTokens.map(x => x.address)]\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 369,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 368,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"widget-block\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"widget-block-icon cursor-pointer\",\n        children: /*#__PURE__*/_jsxDEV(IconSync, {\n          className: \"transform hover:rotate-180 transition duration-500 w-[25px] text-primary dark:text-primary-light\",\n          onClick: () => switchTokens()\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 400,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 399,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"mx-10 mb-16 pt-16\",\n        children: [/*#__PURE__*/_jsxDEV(TokenInputField, {\n          label: \"You Receive\",\n          token: toToken,\n          setToken: setToToken,\n          input: toAmount,\n          amountUsd: toAmountUsd,\n          setAmountUsd: setToAmountUsd,\n          onChange: val => {\n            setToAmount(val);\n            handleFieldChanged(Field.to, fromAmount, val, rate);\n          },\n          selectable: true,\n          startEmpty: true,\n          excludedTokens: fromToken ? [fromToken.address, ...(fromToken.address === ethToken || fromToken.address === wethToken ? [ethToken, wethToken] : [])] : [],\n          includedTokens: keeperDaoTokens.map(x => x.address)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 406,\n          columnNumber: 11\n        }, this), toToken && /*#__PURE__*/_jsxDEV(_Fragment, {\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"flex justify-between items-center mt-28 mb-2 pr-10\",\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"font-medium\",\n              children: \"Rate\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 435,\n              columnNumber: 17\n            }, this), isLoadingRate ? /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"loading-skeleton h-10 w-[190px]\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 437,\n              columnNumber: 19\n            }, this) : /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"text-12\",\n              children: [\"Market Rate:\", ' ', `1 ${fromToken === null || fromToken === void 0 ? void 0 : fromToken.symbol} = ${prettifyNumber(marketRate)} ${toToken === null || toToken === void 0 ? void 0 : toToken.symbol}`]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 439,\n              columnNumber: 19\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 434,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"flex justify-between items-center\",\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"whitespace-nowrap text-20 min-w-[135px]\",\n              children: `1 ${fromToken === null || fromToken === void 0 ? void 0 : fromToken.symbol} =`\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 448,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"relative w-full\",\n              children: [isLoadingRate && /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"absolute flex justify-end bottom-[17px] bg-white dark:bg-blue-4 h-[21px] w-full pr-15\",\n                children: /*#__PURE__*/_jsxDEV(\"div\", {\n                  className: \"loading-skeleton h-[24px] w-4/5\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 452,\n                  columnNumber: 23\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 451,\n                columnNumber: 21\n              }, this), /*#__PURE__*/_jsxDEV(InputField, {\n                format: true,\n                input: rate,\n                onChange: handleRateInput\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 455,\n                columnNumber: 19\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 449,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 447,\n            columnNumber: 15\n          }, this), rateWarning.msg && marketRate !== -1 && /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"flex mt-10\",\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"min-w-[135px]\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 460,\n              columnNumber: 19\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: `mx-8 text-center text-10 sm:text-12 font-light ${classNameGenerator({\n                'text-error': rateWarning.type === 'error',\n                'text-warning': rateWarning.type === 'warning'\n              })}`,\n              children: rateWarning.msg\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 461,\n              columnNumber: 19\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 459,\n            columnNumber: 17\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"flex justify-end space-x-8 mt-15\",\n            children: [percentages.map((slip, index) => /*#__PURE__*/_jsxDEV(\"button\", {\n              className: `btn-sm rounded-10 h-[34px] text-14 ${classNameGenerator({\n                'btn-outline-secondary': selPercentage !== index,\n                'btn-primary': selPercentage === index\n              })} bg-opacity-0`,\n              onClick: () => {\n                calculateRateByMarket(marketRate, index, '');\n                setSelPercentage(index);\n                setPercentage('');\n              },\n              children: [\"+\", slip, \"%\"]\n            }, 'slippage' + slip, true, {\n              fileName: _jsxFileName,\n              lineNumber: 475,\n              columnNumber: 19\n            }, this)), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"w-[70px]\",\n              children: /*#__PURE__*/_jsxDEV(InputField, {\n                input: percentage,\n                onBlur: () => {\n                  const percNum = Number(percentage);\n                  const index = percentages.indexOf(percNum);\n                  if (index !== -1 || !percNum) setPercentage('');\n                  const sel = percNum ? index : selPercentage === -1 ? 1 : selPercentage;\n                  calculateRateByMarket(marketRate, sel, percentage);\n                  setSelPercentage(sel);\n                },\n                onChange: val => {\n                  calculateRateByMarket(marketRate, -1, val);\n                  setPercentage(val);\n                },\n                format: true,\n                placeholder: \"Custom\",\n                customClass: \"text-14 py-6 rounded-10 bg-opacity-0 border border-grey-3 p-6\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 493,\n                columnNumber: 19\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 492,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 473,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"flex justify-between items-center mt-15\",\n            children: [/*#__PURE__*/_jsxDEV(\"span\", {\n              className: \"font-semibold\",\n              children: \"Expires in\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 520,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(ModalDuration, {\n              duration: duration,\n              setDuration: setDuration\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 521,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 519,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 405,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(ModalApprove, {\n        isOpen: showApproveModal,\n        setIsOpen: setShowApproveModal,\n        amount: fromAmount,\n        fromToken: (fromToken === null || fromToken === void 0 ? void 0 : fromToken.address) === ethToken ? { ...fromToken,\n          symbol: 'WETH',\n          address: wethToken\n        } : fromToken,\n        handleApproved: () => handleSwap(true, fromToken.address === ethToken),\n        contract: ApprovalContract.ExchangeProxy\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 527,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(ModalDepositETH, {\n        amount: fromAmount,\n        setIsOpen: setShowEthModal,\n        isOpen: showEthModal,\n        onConfirm: () => handleSwap(true)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 541,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        className: \"btn-primary rounded w-full\",\n        onClick: () => handleSwapClick(),\n        disabled: isSwapDisabled(),\n        children: swapButtonText()\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 547,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 398,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 367,\n    columnNumber: 5\n  }, this);\n};\n\n_s(SwapLimit, \"ZRmnoMhqq8gCz8KuOxaIMPrytP8=\", false, function () {\n  return [useDispatch, useWeb3React, useAppSelector, useAppSelector, useAppSelector, useAppSelector, useAsyncEffect];\n});\n\n_c = SwapLimit;\n\nvar _c;\n\n$RefreshReg$(_c, \"SwapLimit\");","map":{"version":3,"sources":["/Users/safahi/Desktop/webapp-v2-feature-gtm_events/src/elements/swapLimit/SwapLimit.tsx"],"names":["useCallback","useEffect","useMemo","useRef","useState","dayjs","BigNumber","InputField","TokenInputField","ModalDuration","classNameGenerator","getRate","swapLimit","addNotification","NotificationType","useDispatch","useWeb3React","ethToken","wethToken","useAppSelector","openWalletModal","ModalApprove","ApprovalContract","getNetworkContractApproval","prettifyNumber","ConversionEvents","sendConversionEvent","setCurrentConversion","updateTokens","fetchTokenBalances","wait","calculatePercentageChange","ModalDepositETH","useAsyncEffect","Field","SwapLimit","fromToken","setFromToken","toToken","setToToken","switchTokens","refreshLimit","dispatch","chainId","account","state","user","fromAmount","setFromAmount","toAmount","setToAmount","toAmountUsd","setToAmountUsd","fromAmountUsd","setFromAmountUsd","rate","setRate","marketRate","setMarketRate","percentage","setPercentage","selPercentage","setSelPercentage","showApproveModal","setShowApproveModal","showEthModal","setShowEthModal","fromError","setFromError","rateWarning","setRateWarning","type","msg","isLoadingRate","setIsLoadingRate","duration","setDuration","days","hours","minutes","previousField","lastChangedField","tokens","bancor","keeperDaoTokens","fiatToggle","usdToggle","percentages","calculatePercentageByRate","Number","index","indexOf","toFixed","calcFrom","to","amount","div","toString","usdAmount","times","usdPrice","calcTo","from","calcRate","handleFieldChanged","field","current","isTooHigh","lt","isTooLow","calculateRateByMarket","perc","isMounted","address","checkApproval","token","isApprovalReq","ExchangeProxy","approvePop","handleSwap","e","error","title","symbol","updateETHandWETH","weth","find","x","balances","approved","showETHtoWETHModal","notification","isSwapDisabled","eq","findIndex","isInsufficient","balance","gt","handleRateInput","val","swapButtonText","handleSwapClick","tokenPair","asSeconds","click","map","slip","percNum","sel"],"mappings":"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","sourcesContent":["import { useCallback, useEffect, useMemo, useRef, useState } from 'react';\nimport dayjs from 'utils/dayjs';\nimport BigNumber from 'bignumber.js';\nimport { InputField } from 'components/inputField/InputField';\nimport { TokenInputField } from 'components/tokenInputField/TokenInputField';\nimport { ModalDuration } from 'elements/modalDuration/modalDuration';\nimport { Token } from 'services/observables/tokens';\nimport { ReactComponent as IconSync } from 'assets/icons/sync.svg';\nimport { classNameGenerator } from 'utils/pureFunctions';\nimport { getRate } from 'services/web3/swap/market';\nimport { KeeprDaoToken, swapLimit } from 'services/api/keeperDao';\nimport {\n  addNotification,\n  NotificationType,\n} from 'redux/notification/notification';\nimport { useDispatch } from 'react-redux';\nimport { useWeb3React } from '@web3-react/core';\nimport { ethToken, wethToken } from 'services/web3/config';\nimport { useAppSelector } from 'redux/index';\nimport { openWalletModal } from 'redux/user/user';\nimport { ModalApprove } from 'elements/modalApprove/modalApprove';\nimport {\n  ApprovalContract,\n  getNetworkContractApproval,\n} from 'services/web3/approval';\nimport { prettifyNumber } from 'utils/helperFunctions';\nimport {\n  ConversionEvents,\n  sendConversionEvent,\n  setCurrentConversion,\n} from 'services/api/googleTagManager';\nimport { updateTokens } from 'redux/bancor/bancor';\nimport { fetchTokenBalances } from 'services/observables/balances';\nimport { wait } from 'utils/pureFunctions';\nimport { calculatePercentageChange } from 'utils/formulas';\nimport { ModalDepositETH } from 'elements/modalDepositETH/modalDepositETH';\nimport useAsyncEffect from 'use-async-effect';\n\nenum Field {\n  from,\n  to,\n  rate,\n}\n\ninterface SwapLimitProps {\n  fromToken: Token;\n  setFromToken: Function;\n  toToken?: Token;\n  setToToken: Function;\n  switchTokens: Function;\n  refreshLimit: Function;\n}\n\nexport const SwapLimit = ({\n  fromToken,\n  setFromToken,\n  toToken,\n  setToToken,\n  switchTokens,\n  refreshLimit,\n}: SwapLimitProps) => {\n  const dispatch = useDispatch();\n  const { chainId } = useWeb3React();\n  const account = useAppSelector<string | undefined>(\n    (state) => state.user.account\n  );\n  const [fromAmount, setFromAmount] = useState('');\n  const [toAmount, setToAmount] = useState('');\n  const [toAmountUsd, setToAmountUsd] = useState('');\n  const [fromAmountUsd, setFromAmountUsd] = useState('');\n  const [rate, setRate] = useState('');\n  const [marketRate, setMarketRate] = useState(-1);\n  const [percentage, setPercentage] = useState('');\n  const [selPercentage, setSelPercentage] = useState(1);\n  const [showApproveModal, setShowApproveModal] = useState(false);\n  const [showEthModal, setShowEthModal] = useState(false);\n  const [fromError, setFromError] = useState('');\n  const [rateWarning, setRateWarning] = useState({ type: '', msg: '' });\n  const [isLoadingRate, setIsLoadingRate] = useState(false);\n  const [duration, setDuration] = useState(\n    dayjs.duration({ days: 7, hours: 0, minutes: 0 })\n  );\n\n  const previousField = useRef<Field>();\n  const lastChangedField = useRef<Field>();\n  const tokens = useAppSelector<Token[]>((state) => state.bancor.tokens);\n  const keeperDaoTokens = useAppSelector<KeeprDaoToken[]>(\n    (state) => state.bancor.keeperDaoTokens\n  );\n  const fiatToggle = useAppSelector<boolean>((state) => state.user.usdToggle);\n  const percentages = useMemo(() => [1, 3, 5], []);\n\n  const calculatePercentageByRate = useCallback(\n    (marketRate: number, rate: string) => {\n      const percentage = calculatePercentageChange(Number(rate), marketRate);\n      const index = percentages.indexOf(percentage);\n      if (index === -1) {\n        setPercentage(percentage.toFixed(2));\n        setSelPercentage(-1);\n      } else {\n        setPercentage('');\n        setSelPercentage(index);\n      }\n    },\n    [percentages]\n  );\n\n  const calcFrom = useCallback(\n    (to: string, rate: string) => {\n      if (rate && to) {\n        const amount = new BigNumber(to).div(rate);\n        setFromAmount(amount.toString());\n        const usdAmount = amount.times(fromToken!.usdPrice!).toString();\n        setFromAmountUsd(usdAmount);\n      }\n    },\n    [fromToken]\n  );\n  const calcTo = useCallback(\n    (from: string, rate: string) => {\n      if (rate && from && toToken) {\n        const amount = new BigNumber(rate).times(from);\n        setToAmount(amount.toString());\n        const usdAmount = amount.times(toToken.usdPrice!).toString();\n        setToAmountUsd(usdAmount);\n      }\n    },\n    [toToken]\n  );\n  const calcRate = useCallback(\n    (from: string, to: string) => {\n      if (from && to) {\n        const rate = new BigNumber(to).div(from).toString();\n        setRate(rate);\n        calculatePercentageByRate(marketRate, rate);\n      }\n    },\n    [calculatePercentageByRate, marketRate]\n  );\n\n  const handleFieldChanged = useCallback(\n    (field: Field, from: string, to: string, rate: string) => {\n      if (\n        previousField.current !== lastChangedField.current &&\n        lastChangedField.current !== field\n      )\n        previousField.current = lastChangedField.current;\n      lastChangedField.current = field;\n\n      switch (field) {\n        case Field.from:\n          if (previousField.current === Field.to) calcRate(from, to);\n          else calcTo(from, rate);\n          break;\n        case Field.to:\n          if (previousField.current === Field.from) calcRate(from, to);\n          else calcFrom(to, rate);\n          break;\n        case Field.rate:\n          const isTooHigh = new BigNumber(rate).lt(marketRate);\n          const isTooLow = new BigNumber(marketRate).times(1.2).lt(rate);\n          if (isTooHigh) {\n            setRateWarning({\n              type: 'error',\n              msg: 'Pay attention! The rate is lower than market rate, you can get a better rate on market swap',\n            });\n          } else if (isTooLow) {\n            setRateWarning({\n              type: 'warning',\n              msg: 'Pay attention! The rate is too high above market rate and will likely not be fulfilled',\n            });\n          } else {\n            setRateWarning({\n              type: '',\n              msg: '',\n            });\n          }\n          if (previousField.current === Field.from) calcTo(from, rate);\n          else calcFrom(to, rate);\n          break;\n      }\n    },\n    [calcRate, calcTo, calcFrom, marketRate]\n  );\n\n  const calculateRateByMarket = (\n    marketRate: number,\n    selPercentage: number,\n    percentage: string\n  ) => {\n    const perc =\n      selPercentage === -1\n        ? Number(percentage) / 100\n        : percentages[selPercentage] / 100;\n    const rate = (marketRate * (1 + perc)).toFixed(6);\n    handleFieldChanged(Field.rate, fromAmount, toAmount, rate);\n    setRate(rate);\n  };\n\n  useAsyncEffect(\n    async (isMounted) => {\n      if (!fromToken || !toToken) return;\n      if (toToken.address === ethToken && fromToken.address === wethToken)\n        return;\n\n      if (isMounted()) {\n        setIsLoadingRate(true);\n        const rate = Number(await getRate(fromToken, toToken, '1'));\n        setMarketRate(rate);\n        calculateRateByMarket(rate, 1, '');\n        setIsLoadingRate(false);\n        setRateWarning({\n          type: '',\n          msg: '',\n        });\n      }\n    },\n    [toToken?.address, fromToken?.address]\n  );\n\n  //Check if approval is required\n  const checkApproval = async (token: Token) => {\n    try {\n      const isApprovalReq = await getNetworkContractApproval(\n        token,\n        ApprovalContract.ExchangeProxy,\n        fromAmount\n      );\n      if (isApprovalReq) {\n        sendConversionEvent(ConversionEvents.approvePop);\n        setShowApproveModal(true);\n      } else await handleSwap(true, token.address === wethToken);\n    } catch (e: any) {\n      dispatch(\n        addNotification({\n          type: NotificationType.error,\n          title: 'Transaction Failed',\n          msg: `${token.symbol} approval had failed. Please try again or contact support.`,\n        })\n      );\n    }\n  };\n\n  const updateETHandWETH = async () => {\n    if (!(chainId && toToken && account)) return;\n\n    const weth = tokens.find((x) => x.address === wethToken);\n    await wait(4000);\n    const balances = await fetchTokenBalances(\n      weth ? [fromToken, weth] : [fromToken],\n      account\n    );\n    dispatch(updateTokens(balances));\n  };\n\n  const handleSwap = async (\n    approved: boolean = false,\n    weth: boolean = false,\n    showETHtoWETHModal: boolean = false\n  ) => {\n    if (!account) {\n      dispatch(openWalletModal(true));\n      return;\n    }\n\n    if (!(fromToken && toToken && fromAmount && toAmount)) return;\n\n    if (showETHtoWETHModal) return setShowEthModal(true);\n\n    if (!approved) return checkApproval(fromToken);\n\n    const notification = await swapLimit(\n      weth ? { ...fromToken, address: wethToken } : fromToken,\n      toToken,\n      fromAmount,\n      toAmount,\n      account,\n      duration,\n      checkApproval\n    );\n\n    if (notification) dispatch(addNotification(notification));\n    if (fromToken.address === ethToken) updateETHandWETH();\n    refreshLimit();\n  };\n\n  const isSwapDisabled = () => {\n    if (isLoadingRate) return true;\n    if (fromError !== '') return true;\n    if (\n      fromAmount === '' ||\n      toAmount === '' ||\n      rate === '' ||\n      new BigNumber(fromAmount).eq(0) ||\n      new BigNumber(toAmount).eq(0) ||\n      new BigNumber(rate).eq(0)\n    )\n      return true;\n    if (!toToken) return true;\n    if (!account) return false;\n    if (\n      toToken.address === ethToken ||\n      keeperDaoTokens.findIndex((x) => x.address === toToken.address) === -1 ||\n      (fromToken.address !== ethToken &&\n        keeperDaoTokens.findIndex((x) => x.address === fromToken.address) ===\n          -1)\n    )\n      return true;\n\n    return false;\n  };\n\n  // handle input errors\n  useEffect(() => {\n    const isInsufficient =\n      fromToken &&\n      fromToken.balance &&\n      new BigNumber(fromAmount).gt(fromToken.balance);\n    if (isInsufficient) setFromError('Token balance is currently insufficient');\n    else setFromError('');\n  }, [fromAmount, fromToken]);\n\n  const handleRateInput = (val: string) => {\n    setRate(val);\n    calculatePercentageByRate(marketRate, val);\n    handleFieldChanged(Field.rate, fromAmount, toAmount, val);\n  };\n\n  const swapButtonText = () => {\n    if (!toToken) return 'Select a token';\n    else if (\n      fromToken.address !== ethToken &&\n      keeperDaoTokens.findIndex((x) => x.address === fromToken.address) === -1\n    )\n      return `${fromToken.symbol} token is not supported`;\n    if (toToken.address === ethToken) return 'Please change ETH to WETH';\n    else if (\n      keeperDaoTokens.findIndex((x) => x.address === toToken.address) === -1\n    )\n      return `${toToken.symbol} token is not supported`;\n\n    return 'Trade';\n  };\n\n  const handleSwapClick = () => {\n    const tokenPair = fromToken.symbol + '/' + toToken?.symbol;\n    setCurrentConversion(\n      'Limit',\n      chainId,\n      tokenPair,\n      fromToken.symbol,\n      toToken?.symbol,\n      fromAmount,\n      fromAmountUsd,\n      toAmount,\n      toAmountUsd,\n      fiatToggle,\n      rate,\n      percentage,\n      duration.asSeconds().toString()\n    );\n    sendConversionEvent(ConversionEvents.click);\n    handleSwap(false, false, fromToken.address === ethToken);\n  };\n\n  return (\n    <div>\n      <div className=\"px-20\">\n        <TokenInputField\n          label=\"You Pay\"\n          token={fromToken}\n          setToken={setFromToken}\n          input={fromAmount}\n          amountUsd={fromAmountUsd}\n          setAmountUsd={setFromAmountUsd}\n          onChange={(val: string) => {\n            setFromAmount(val);\n            handleFieldChanged(Field.from, val, toAmount, rate);\n          }}\n          border\n          selectable\n          excludedTokens={\n            toToken\n              ? [\n                  toToken.address,\n                  ...(toToken.address === ethToken ||\n                  toToken.address === wethToken\n                    ? [ethToken, wethToken]\n                    : []),\n                ]\n              : []\n          }\n          errorMsg={fromError}\n          includedTokens={[ethToken, ...keeperDaoTokens.map((x) => x.address)]}\n        />\n      </div>\n\n      <div className=\"widget-block\">\n        <div className=\"widget-block-icon cursor-pointer\">\n          <IconSync\n            className=\"transform hover:rotate-180 transition duration-500 w-[25px] text-primary dark:text-primary-light\"\n            onClick={() => switchTokens()}\n          />\n        </div>\n        <div className=\"mx-10 mb-16 pt-16\">\n          <TokenInputField\n            label=\"You Receive\"\n            token={toToken}\n            setToken={setToToken}\n            input={toAmount}\n            amountUsd={toAmountUsd}\n            setAmountUsd={setToAmountUsd}\n            onChange={(val: string) => {\n              setToAmount(val);\n              handleFieldChanged(Field.to, fromAmount, val, rate);\n            }}\n            selectable\n            startEmpty\n            excludedTokens={\n              fromToken\n                ? [\n                    fromToken.address,\n                    ...(fromToken.address === ethToken ||\n                    fromToken.address === wethToken\n                      ? [ethToken, wethToken]\n                      : []),\n                  ]\n                : []\n            }\n            includedTokens={keeperDaoTokens.map((x) => x.address)}\n          />\n          {toToken && (\n            <>\n              <div className=\"flex justify-between items-center mt-28 mb-2 pr-10\">\n                <div className=\"font-medium\">Rate</div>\n                {isLoadingRate ? (\n                  <div className=\"loading-skeleton h-10 w-[190px]\"></div>\n                ) : (\n                  <div className=\"text-12\">\n                    Market Rate:{' '}\n                    {`1 ${fromToken?.symbol} = ${prettifyNumber(marketRate)} ${\n                      toToken?.symbol\n                    }`}\n                  </div>\n                )}\n              </div>\n              <div className=\"flex justify-between items-center\">\n                <div className=\"whitespace-nowrap text-20 min-w-[135px]\">{`1 ${fromToken?.symbol} =`}</div>\n                <div className=\"relative w-full\">\n                  {isLoadingRate && (\n                    <div className=\"absolute flex justify-end bottom-[17px] bg-white dark:bg-blue-4 h-[21px] w-full pr-15\">\n                      <div className=\"loading-skeleton h-[24px] w-4/5\"></div>\n                    </div>\n                  )}\n                  <InputField format input={rate} onChange={handleRateInput} />\n                </div>\n              </div>\n              {rateWarning.msg && marketRate !== -1 && (\n                <div className=\"flex mt-10\">\n                  <div className=\"min-w-[135px]\"></div>\n                  <div\n                    className={`mx-8 text-center text-10 sm:text-12 font-light ${classNameGenerator(\n                      {\n                        'text-error': rateWarning.type === 'error',\n                        'text-warning': rateWarning.type === 'warning',\n                      }\n                    )}`}\n                  >\n                    {rateWarning.msg}\n                  </div>\n                </div>\n              )}\n              <div className=\"flex justify-end space-x-8 mt-15\">\n                {percentages.map((slip, index) => (\n                  <button\n                    key={'slippage' + slip}\n                    className={`btn-sm rounded-10 h-[34px] text-14 ${classNameGenerator(\n                      {\n                        'btn-outline-secondary': selPercentage !== index,\n                        'btn-primary': selPercentage === index,\n                      }\n                    )} bg-opacity-0`}\n                    onClick={() => {\n                      calculateRateByMarket(marketRate, index, '');\n                      setSelPercentage(index);\n                      setPercentage('');\n                    }}\n                  >\n                    +{slip}%\n                  </button>\n                ))}\n                <div className=\"w-[70px]\">\n                  <InputField\n                    input={percentage}\n                    onBlur={() => {\n                      const percNum = Number(percentage);\n                      const index = percentages.indexOf(percNum);\n                      if (index !== -1 || !percNum) setPercentage('');\n\n                      const sel = percNum\n                        ? index\n                        : selPercentage === -1\n                        ? 1\n                        : selPercentage;\n                      calculateRateByMarket(marketRate, sel, percentage);\n                      setSelPercentage(sel);\n                    }}\n                    onChange={(val: string) => {\n                      calculateRateByMarket(marketRate, -1, val);\n                      setPercentage(val);\n                    }}\n                    format\n                    placeholder=\"Custom\"\n                    customClass=\"text-14 py-6 rounded-10 bg-opacity-0 border border-grey-3 p-6\"\n                  />\n                </div>\n              </div>\n\n              <div className=\"flex justify-between items-center mt-15\">\n                <span className=\"font-semibold\">Expires in</span>\n                <ModalDuration duration={duration} setDuration={setDuration} />\n              </div>\n            </>\n          )}\n        </div>\n\n        <ModalApprove\n          isOpen={showApproveModal}\n          setIsOpen={setShowApproveModal}\n          amount={fromAmount}\n          fromToken={\n            fromToken?.address === ethToken\n              ? { ...fromToken, symbol: 'WETH', address: wethToken }\n              : fromToken\n          }\n          handleApproved={() =>\n            handleSwap(true, fromToken.address === ethToken)\n          }\n          contract={ApprovalContract.ExchangeProxy}\n        />\n        <ModalDepositETH\n          amount={fromAmount}\n          setIsOpen={setShowEthModal}\n          isOpen={showEthModal}\n          onConfirm={() => handleSwap(true)}\n        />\n        <button\n          className=\"btn-primary rounded w-full\"\n          onClick={() => handleSwapClick()}\n          disabled={isSwapDisabled()}\n        >\n          {swapButtonText()}\n        </button>\n      </div>\n    </div>\n  );\n};\n"]},"metadata":{},"sourceType":"module"}